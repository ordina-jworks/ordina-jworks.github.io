<!DOCTYPE html>
<!--suppress ALL -->
<html>
<head>
        <meta charset="utf-8">
    <meta name="description" content="We build innovative solutions with Java and JavaScript. To support this mission, we have several Competence Centers. From within those Competence Centers, we provide coaching to the employee and expert advice towards our customer. In order to keep in sync with the latest technologies and the latest trends, we frequently visit conferences around the globe.
">
    <meta name="keywords" content="Ordina,ORAJ,JWorks,Blog,Java,JavaScript,TypeScript,Angular,DevOps">
    <meta name="author" content="Ordina Belgium">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/img/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/img/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/favicons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-128.png" sizes="128x128" />

    

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="SpringOne Platform - Fun With The Functional Web Framework - Pieter Van Hees">
    <meta name="twitter:description" content="Ordina JWorks Tech Blog">
    <meta name="twitter:image" content="http://ordina-jworks.github.io/img/2018-09-27-SpringOne-Platform/post-image.jpg"/>

    <!-- Facebook Open Graph -->
    <meta property="og:url" content="http://ordina-jworks.github.io/spring/2018/09/28/SpringOne-fun-with-the-functional-web-framework.html"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="SpringOne Platform - Fun With The Functional Web Framework - Pieter Van Hees"/>
    <meta property="og:description" content="Ordina JWorks Tech Blog"/>
    <meta property="og:image" content="http://ordina-jworks.github.io/img/2018-09-27-SpringOne-Platform/post-image.jpg"/>

    
    <title>SpringOne Platform - Fun With The Functional Web Framework - Pieter Van Hees &mdash; Ordina JWorks Tech Blog</title>
    

        <!-- Styles -->
    <!-- Font awesome CSS -->
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <!-- Magnific Popup -->
    <link href="/css/magnific-popup.css" rel="stylesheet">
    <!-- Owl carousel -->
    <link href="/css/owl.carousel.css" rel="stylesheet">

    <!-- CSS for this page -->

    <!-- Syntax highlighting -->
    <link href="/css/syntax.css" rel="stylesheet">


    <!--[if lte IE 8]>
    <script src="/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/css/main.css"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/css/ie9.css"/><![endif]-->
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/ie8.css"/><![endif]-->

    <!-- Custom CSS. Type your CSS code in custom.css file -->
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Vertical timeline -->
	<link rel="stylesheet" href="/css/vertical-timeline/style.css"> <!-- Resource style -->

    <!-- Favicon -->
    <link rel="shortcut icon" href="#">

    <script src="https://use.typekit.net/gzh0mbm.js"></script>
    <script>
        try {
            Typekit.load({async: true});
        } catch (e) {
        }
    </script>
</head>

<body>
<div id="header-image"></div>


<!-- Page Wrapper -->
<div id="page-wrapper">

        <!-- Header -->
    <header id="header">
        <h1>
            <a href="/">
                JWorks Tech Blog
            </a>
        </h1>

        <nav>
            <a href="#menu">Menu</a>
            <form action="/search/" method="get" class="header-search search-form">
                <input type="text" id="search-box-header" name="query" placeholder="Search &hellip;">
            </form>
        </nav>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <div class="inner">
            <h2>Menu</h2>
            <ul class="links">
                <li class="menu-item"><a href="/">Home</a></li>
                <li class="menu-item"><a href="/about">About Us</a></li>
                <li class="menu-item"><a href="/meet-the-team">Meet the team</a></li>
                <li class="menu-item"><a href="/jobs">Jobs</a></li>
                <li class="menu-item"><a href="/search">Search</a></li>
                <li class="menu-item"><a href="https://join.ordina-jworks.io/">JOIN</a></li>
                <li class="menu-item"><a href="/contact">Contact Us</a></li>
            </ul>
            <a href="#" class="close">Close</a>
        </div>
    </nav>

    <section id="banner">
        <header>
            <div class="inner">
                

                <h2>SpringOne Platform - Fun With The Functional Web Framework</h2>
                

                
                    Posted Sep 28, 2018


    in <a href="/categories/spring/">Spring</a>



    by
    
        <a href="/author/pieter-van-hees/">Pieter Van Hees</a>
        
    



    <br/>
    <i class="fa fa-tags"></i>
    
        <a href="/tags/springone-platform/">SpringOne Platform</a>, 
    
        <a href="/tags/conference/">Conference</a>, 
    
        <a href="/tags/pivotal/">Pivotal</a>, 
    
        <a href="/tags/functional-programming/">Functional Programming</a>, 
    
        <a href="/tags/functional-web-framework/">Functional Web Framework</a>, 
    
        <a href="/tags/spring/">Spring</a>, 
    
        <a href="/tags/spring-webflux/">Spring WebFlux</a>, 
    
        <a href="/tags/web-mvc/">Web MVC</a>
    

                

                

            </div>
        </header>
    </section>


    <section id="wrapper">
        <div class="inner">
            <section id="one" class="wrapper spotlight style1 post-body">
    <div class="inner" style="text-align: left;">
        <div class="content">
            <h1 id="fun-with-the-functional-web-framework">Fun with the Functional Web Framework</h1>

<h3 id="by-arjen-poutsma">by <a href="https://twitter.com/poutsma" target="_blank">Arjen Poutsma</a></h3>

<p>This talk is a follow-up of a talk that Arjen Poutsma has been giving a few years now, called ‘New in Spring 5: Functional Web Framework’. 
In his new talk he goes more in depth in some of the features that are offered by the framework.</p>

<h1 id="what-is-it">What is it?</h1>

<p>The Spring functional web framework (called WebFlux.fn) is an alternative to the annotational style web framework, Web MVC.
It was introduced in Spring 5.0 and for spring 5.1 they did some refinements in the API after feedback from developers.</p>

<h1 id="design-goals">Design goals</h1>

<p>The WebFlux.fn framework had three main goals.</p>

<p>The first one was to create a web framework with a functional style.
By this they mean that they wanted to leverage the new functional concepts introduced in Java 8, like <code class="language-plaintext highlighter-rouge">Function</code> and <code class="language-plaintext highlighter-rouge">Stream</code>.</p>

<p>The second goal was to make the framework fully reactive by using the functionality from <a href="https://projectreactor.io" target="_blank">Reactor</a>.</p>

<p>The third goal was to act more like a library and less like a framework.
The reason for this is that many people don’t like the “automagic” things the Web MVC (annotational style) framework does.
Web MVC does a lot of things behind the scenes that you as a client of the framework don’t know about, unless you read up on how the framework works internally.
So acting more like a library instead of a framework means that a lot of things will be more explicit, so you as a client of the library will see more clearly what is going to happen.</p>

<p>A fourth goal, that was more a side effect than intention, is that there is no more reflection in WebFlux.fn.
By not using annotations anymore to map HTTP requests to controller methods, there is no more reflection.
This has the great effect that your application will take less time to start up because Spring has to do less classpath scanning.
This is also useful for when you want to use GraalVM.</p>

<h2 id="how-does-it-work">How does it work</h2>
<p>There are three main concepts in the WebFlux.fn framework:</p>
<ul>
  <li>The <code class="language-plaintext highlighter-rouge">HandlerFunction</code></li>
  <li>The <code class="language-plaintext highlighter-rouge">RouterFunction</code></li>
  <li>The <code class="language-plaintext highlighter-rouge">HandlerFilterFunction</code></li>
</ul>

<p>We’ll discuss these in the following sections.</p>

<h3 id="the-handlerfunction">The HandlerFunction</h3>
<p>Is a function that maps a <code class="language-plaintext highlighter-rouge">ServerRequest</code> to a <code class="language-plaintext highlighter-rouge">Mono&lt;ServerResponse&gt;</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="nf">showPet</span><span class="o">(</span><span class="nc">ServerRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">pathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">petRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
            <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">pet</span> <span class="o">-&gt;</span> <span class="nc">ServerResponse</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">contentType</span><span class="o">(</span><span class="no">APPLICATION_JSON</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="n">fromObject</span><span class="o">(</span>
                    <span class="n">pet</span><span class="o">)))</span>
            <span class="o">.</span><span class="na">switchIfEmpty</span><span class="o">(</span><span class="nc">Mono</span><span class="o">.</span><span class="na">defer</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="nc">ServerResponse</span><span class="o">.</span><span class="na">notFound</span><span class="o">().</span><span class="na">build</span><span class="o">()));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>You can see in this example that there are some differences with a Web MVC controller method.</p>

<p>A big difference is that we can only get a <code class="language-plaintext highlighter-rouge">ServerRequest</code> as a parameter. 
So if we want a path variable, body or anything else from the HTTP request, we have to get it from the <code class="language-plaintext highlighter-rouge">ServerRequest</code> variable.
Spring does not inject this information as method parameters in WebFlux.fn.</p>

<p>The second difference is that the object we return has to be a <code class="language-plaintext highlighter-rouge">Mono&lt;ServerResponse&gt;</code>.
In Web MVC the return type could be a lot of different things like any type of <code class="language-plaintext highlighter-rouge">Object</code>, a <code class="language-plaintext highlighter-rouge">ResponseEntity</code>, etc.</p>

<h3 id="the-routerfunction">The RouterFunction</h3>
<p>Is a function that takes a <code class="language-plaintext highlighter-rouge">ServerRequest</code> and returns a <code class="language-plaintext highlighter-rouge">HandlerFunction</code> using a <code class="language-plaintext highlighter-rouge">RequestPredicate</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="nf">routerFunction</span><span class="o">(</span><span class="nc">PetHandler</span> <span class="n">petHandler</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="n">html</span> <span class="o">=</span> <span class="n">route</span><span class="o">()</span>
            <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">"/pets/{id}"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="no">TEXT_HTML</span><span class="o">),</span> <span class="nl">petHandler:</span><span class="o">:</span><span class="n">renderPet</span><span class="o">)</span>
            <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="no">TEXT_HTML</span><span class="o">),</span> <span class="nl">petHandler:</span><span class="o">:</span><span class="n">renderPets</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="n">route</span><span class="o">()</span>
            <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">"/pets/{id}"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="no">APPLICATION_JSON</span><span class="o">),</span> <span class="nl">petHandler:</span><span class="o">:</span><span class="n">showPet</span><span class="o">)</span>
            <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="no">APPLICATION_JSON</span><span class="o">),</span> <span class="nl">petHandler:</span><span class="o">:</span><span class="n">showPets</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The order in which you define these router functions matters.
The first router function’s  handler that matches your HTTP request will be the one that is executed.
This makes it a lot clearer when you read the router functions to know which one will be executed, it’s the first one that you define and matches.</p>

<p>An advantage of the <code class="language-plaintext highlighter-rouge">RouterFunction</code> over the annotational style is that you can map multiple endpoints to the same <code class="language-plaintext highlighter-rouge">HandlerFunction</code>.
This is not possible in Web MVC because you can only put one @RequestMapping on a controller method.
In the WebFlux.fn framework however, you can refer to one <code class="language-plaintext highlighter-rouge">HandlerFunction</code> in as many <code class="language-plaintext highlighter-rouge">RouterFunction</code> matchers as you want.</p>

<h4 id="improvements-in-the-routerfunction-spring-framework-51">Improvements in the RouterFunction spring framework 5.1:</h4>

<ol>
  <li>A router DSL with less static imports:
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">//5.0 version</span>
 <span class="n">route</span><span class="o">(</span><span class="no">GET</span><span class="o">(</span><span class="s">"/people"</span><span class="o">),</span> <span class="nl">personHandler:</span><span class="o">:</span><span class="n">getPeople</span><span class="o">)</span>
 <span class="c1">//5.1 version</span>
 <span class="n">route</span><span class="o">()</span>
   <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">"/people"</span><span class="o">),</span> <span class="nl">personHandler:</span><span class="o">:</span><span class="n">getPeople</span><span class="o">)</span>
</code></pre></div>    </div>
  </li>
  <li>And a new pattern matcher to resolve which <code class="language-plaintext highlighter-rouge">HandlerFunction</code> to call, which is a lot faster than the previous one.</li>
</ol>

<h4 id="requestpredicates">RequestPredicates</h4>
<p>Is a function that maps a <code class="language-plaintext highlighter-rouge">ServerRequest</code> to a <code class="language-plaintext highlighter-rouge">boolean</code>.</p>

<p>This is used to match your <code class="language-plaintext highlighter-rouge">HandlerFunction</code> to a HTTP request.
Spring provides a lot of default predicates for paths, accept headers, etc.
But you can also create your own very easily, with lambdas, methods, or classes.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lambda</span>
<span class="n">route</span><span class="o">().</span><span class="na">GET</span><span class="o">(</span><span class="s">"/people"</span><span class="o">,</span> <span class="n">serverRequest</span> <span class="o">-&gt;</span> <span class="n">serverRequest</span><span class="o">.</span><span class="na">path</span><span class="o">().</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".json"</span><span class="o">),</span> <span class="nl">personHandler:</span><span class="o">:</span><span class="n">getPeople</span><span class="o">)</span>

<span class="c1">// method</span>
<span class="n">route</span><span class="o">().</span><span class="na">GET</span><span class="o">(</span><span class="s">"/people"</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">pathEndsWithJson</span><span class="o">,</span> <span class="nl">personHandler:</span><span class="o">:</span><span class="n">getPeople</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">pathEndsWithJson</span><span class="o">(</span><span class="nc">ServerRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">path</span><span class="o">().</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".json"</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// class</span>
<span class="n">route</span><span class="o">().</span><span class="na">GET</span><span class="o">(</span><span class="s">"/people"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">PathEndsWithJsonPredicate</span><span class="o">(),</span> <span class="nl">personHandler:</span><span class="o">:</span><span class="n">getPeople</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PathEndsWithJsonPredicate</span> <span class="kd">implements</span> <span class="nc">RequestPredicate</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">test</span><span class="o">(</span><span class="kd">final</span> <span class="nc">ServerRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">path</span><span class="o">().</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".json"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="nested-routerfunction">nested RouterFunction</h4>
<p>Similar to the class level <code class="language-plaintext highlighter-rouge">@RequestMapping</code>, but a lot more powerful.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="nf">petsRouter</span><span class="o">(</span><span class="nc">PetJsonHandler</span> <span class="n">petJsonHandler</span><span class="o">,</span> <span class="nc">PetHtmlHandler</span> <span class="n">petHtmlHandler</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="n">html</span> <span class="o">=</span> <span class="n">route</span><span class="o">()</span>
            <span class="o">.</span><span class="na">nest</span><span class="o">(</span><span class="n">accept</span><span class="o">(</span><span class="no">TEXT_HTML</span><span class="o">),</span> <span class="n">builder</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">builder</span>
                <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">,</span> <span class="nl">petHtmlHandler:</span><span class="o">:</span><span class="n">renderPet</span><span class="o">)</span>
                <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="nl">petHtmlHandler:</span><span class="o">:</span><span class="n">renderPets</span><span class="o">);</span>
            <span class="o">}).</span><span class="na">build</span><span class="o">();</span>

    <span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="n">route</span><span class="o">()</span>
            <span class="o">.</span><span class="na">nest</span><span class="o">(</span><span class="n">accept</span><span class="o">(</span><span class="no">APPLICATION_JSON</span><span class="o">),</span> <span class="n">builder</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">builder</span>
                <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="no">APPLICATION_JSON</span><span class="o">),</span> <span class="nl">petJsonHandler:</span><span class="o">:</span><span class="n">showPet</span><span class="o">)</span>
                <span class="o">.</span><span class="na">GET</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="no">APPLICATION_JSON</span><span class="o">),</span> <span class="nl">petJsonHandler:</span><span class="o">:</span><span class="n">showPets</span><span class="o">);</span>
            <span class="o">}).</span><span class="na">build</span><span class="o">();</span>

    <span class="k">return</span> <span class="nf">route</span><span class="o">()</span>
            <span class="o">.</span><span class="na">path</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">html</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">json</span><span class="o">))</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>You can choose on what you nest, depending on the needs of your software.</p>

<p>In WebFlux.fn you can couple HTTP requests for the same path, but different accept headers to different classes, as in the example above.
Here you only define your path once which means no duplication, and it’s easier to change the path to for example <code class="language-plaintext highlighter-rouge">/animals</code>, because there is only one place where you have to change it.</p>

<p>In Web MVC it would look like this.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/pets"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_VALUE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PetJsonController</span> <span class="o">{</span>
<span class="o">...</span>
<span class="o">}</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/pets"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="nc">MediaType</span><span class="o">.</span><span class="na">TEXT_HTML_VALUE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PetHtmlController</span> <span class="o">{</span>
<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="the-handlerfilterfunction">The HandlerFilterFunction</h3>
<p>Is a function that takes a <code class="language-plaintext highlighter-rouge">ServerRequest</code> and a <code class="language-plaintext highlighter-rouge">HandlerFunction</code> and returns a <code class="language-plaintext highlighter-rouge">ServerResponse</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="nf">mainRouter</span><span class="o">(</span><span class="nc">PetHandler</span> <span class="n">petHandler</span><span class="o">,</span> <span class="nc">OwnerHandler</span> <span class="n">ownerHandler</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="n">petsRouter</span> <span class="o">=</span> <span class="n">petsRouter</span><span class="o">(</span><span class="n">petHandler</span><span class="o">);</span>
    <span class="nc">RouterFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="n">ownerRouter</span> <span class="o">=</span> <span class="n">ownerRouter</span><span class="o">(</span><span class="n">ownerHandler</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">petsRouter</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">ownerRouter</span><span class="o">)</span>
            <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">performanceLogging</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="nf">performanceLogging</span><span class="o">(</span><span class="nc">ServerRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HandlerFunction</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Instant</span> <span class="n">start</span> <span class="o">=</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">ServerResponse</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">next</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="nc">Duration</span> <span class="n">duration</span> <span class="o">=</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
    <span class="no">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Processing request {} took {} ms "</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">duration</span><span class="o">.</span><span class="na">toMillis</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">HandlerFilterFunction</code> is more flexible than Servlet filters because you can put a <code class="language-plaintext highlighter-rouge">HandlerFilterFunction</code> on a <code class="language-plaintext highlighter-rouge">RouterFunction</code>.
This means that you can apply this filter to a subset of your routes instead of on all routes.</p>

<p>It can be used for example for security, logging, timing, etc.</p>

<h3 id="future-evolutions">Future evolutions</h3>

<p>Currently the functional web framework does not work with Servlets but only with Spring’s self made <code class="language-plaintext highlighter-rouge">ServerRequest</code> and <code class="language-plaintext highlighter-rouge">ServerResponse</code>.
They are however looking at creating a functional web framework that works with Servlets and without Reactor.</p>

<h2 id="conclusion">Conclusion</h2>
<p>The functional web framework is a lot better</p>
<ul>
  <li>in what properties of the HTTP request you can match on to choose a controller function.</li>
  <li>in reducing duplication of your matching logic</li>
  <li>in providing a clean way to separate controller logic and routing logic</li>
  <li>in explicitness of routing so you can easily see how your HTTP request will be bound to a controller method</li>
</ul>

<p>It is a very good alternative to the more common annotational style web framework Web MVC. 
The advantages mentioned definitely make it worth trying it out for yourself!</p>

<p>#References</p>
<ul>
  <li><a href="https://github.com/poutsma/fun-with-functional" target="_blank">Code from the talk</a></li>
  <li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html" target="_blank">Documentation</a></li>
</ul>

        </div>
    </div>
    <div class="share-page" >
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://ordina-jworks.github.io/spring/2018/09/28/SpringOne-fun-with-the-functional-web-framework.html&title=SpringOne Platform - Fun With The Functional Web Framework&source=https://ordina-jworks.github.io" rel="nofollow" target="_blank" title="Share on LinkedIN">
            <img src="/img/social-media/LinkedIn.png"
                 alt="Share on LinkedIn" />
        </a>
        <a href="https://twitter.com/intent/tweet?text=SpringOne Platform - Fun With The Functional Web Framework&url=https://ordina-jworks.github.io/spring/2018/09/28/SpringOne-fun-with-the-functional-web-framework.html&via=lifeatordinabe&related=lifeatordinabe" rel="nofollow" target="_blank" title="Share on Twitter">
            <img src="/img/social-media/Twitter.png"
                 alt="Share on Twitter" />
        </a>
        <a href="https://facebook.com/sharer.php?u=https://ordina-jworks.github.io/spring/2018/09/28/SpringOne-fun-with-the-functional-web-framework.html" rel="nofollow" target="_blank" title="Share on Facebook">
            <img src="/img/social-media/Facebook.png"
                 alt="Share on Facebook" />
        </a>
    </div>
        
</section>


<section id="two" class="wrapper alt spotlight style2">
    
    <div class="inner">
        <a href="/author/pieter-van-hees/" class="image spotlight-image" title="">
            <img src="/img/author/pieter-van-hees.jpg"
                 alt="" class="p-image"/>
        </a>

        <div class="content">
            
            <p><p>Pieter Van Hees is a Java Software Engineer at Ordina Belgium. He is passionate about Domain-Driven Design and producing clean software that works</p>
</p>
            
        </div>
    </div>
    
</section>

        </div>
    </section>
</div>



<footer>
    <div class="contact">
        <div class="address">
            <div class="icon"><i class="fa fa-fw fa-home"></i></div>
            <div class="text">Ordina Belgium<br/>Blarenberglaan 3B,<br/>2800 Mechelen, Belgium</div>
        </div>
        <div class="phone">
            <div class="icon"><i class="fa fa-fw fa-phone"></i></div>
            <div class="text"><a href="tel:003215295858">+32 15 29 58 58</a></div>
        </div>
        <div class="email">
            <div class="icon"><i class="fa fa-fw fa-envelope-o"></i></div>
            <div class="text"><a href="mailto:jworks@ordina.be">jworks@ordina.be</a></div>
        </div>
    </div>
    <ul class="social">
        <li>
            <a href="https://www.facebook.com/lifeatordinabe" target="_blank">
                <i class=" fa fa-fw fa-facebook"></i><span>Facebook</span>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/company/ordinabelgium" target="_blank">
                <i class=" fa fa-fw fa-linkedin"></i><span>LinkedIn</span>
            </a>
        </li>
        <li>
            <a href="/youtube" target="_blank">
                <i class=" fa fa-fw fa-youtube"></i><span>YouTube</span>
            </a>
        </li>
        <li>
            <a href="/github" target="_blank">
                <i class=" fa fa-fw fa-github"></i><span>GitHub</span>
            </a>
        </li>
        <li>
            <a href="/feed.xml" target="_blank">
                <i class=" fa fa-fw fa-rss"></i><span>RSS Feed</span>
            </a>
        </li>
    </ul>
    <div class="copyright">
        &copy; 2023 Ordina JWorks. All rights reserved.
        <br /> Disclaimer: Opinions expressed on this blog reflect the writer's views and not the position of Ordina
        <img id="analyticsImg" src="" width="1" height="1" style="border: 0px"/>
    </div>
</footer>
<!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollex.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/jquery.pin.min.js"></script>
<script src="/js/util.js"></script>
<!--[if lte IE 8]>
<script src="/js/ie/respond.min.js"></script><![endif]-->


<script>
    var imageHref = "/img/2018-09-27-SpringOne-Platform/post-image.jpg";
    $(function () {
        $('body').addClass('toggle');
    });
</script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o);
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-70040502-1', 'auto');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
    window.addEventListener('load', function () {
        if (window.ga && ga.create) {
            console.log('GA loaded correctly');
        } else {
            console.log('GA is blocked or failed to load - tracking manually...')
            document.getElementById('analyticsImg').src = 'https://jworks-techblog-analytics.cfapps.io/collect?title=' + document.title;
        }
    }, false);
</script>

<!-- Vertical timeline -->
<script src="/js/vertical-timeline/modernizr.js"></script>
<script src="/js/vertical-timeline/main.js"></script>


</body>
</html>
