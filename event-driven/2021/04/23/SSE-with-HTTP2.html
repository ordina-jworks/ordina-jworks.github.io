<!DOCTYPE html>
<!--suppress ALL -->
<html>
<head>
        <meta charset="utf-8">
    <meta name="description" content="We build innovative solutions with Java and JavaScript. To support this mission, we have several Competence Centers. From within those Competence Centers, we provide coaching to the employee and expert advice towards our customer. In order to keep in sync with the latest technologies and the latest trends, we frequently visit conferences around the globe.
">
    <meta name="keywords" content="Ordina,ORAJ,JWorks,Blog,Java,JavaScript,TypeScript,Angular,DevOps">
    <meta name="author" content="Ordina Belgium">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/img/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/img/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/favicons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-128.png" sizes="128x128" />

    

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="SSE with HTTP2 - Jago Staes">
    <meta name="twitter:description" content="Ordina JWorks Tech Blog">
    <meta name="twitter:image" content="http://ordina-jworks.github.io/img/2021-04-23-SSE-HTTP2/SSE-HTTP2.png"/>

    <!-- Facebook Open Graph -->
    <meta property="og:url" content="http://ordina-jworks.github.io/event-driven/2021/04/23/SSE-with-HTTP2.html"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="SSE with HTTP2 - Jago Staes"/>
    <meta property="og:description" content="Ordina JWorks Tech Blog"/>
    <meta property="og:image" content="http://ordina-jworks.github.io/img/2021-04-23-SSE-HTTP2/SSE-HTTP2.png"/>

    
    <title>SSE with HTTP2 - Jago Staes &mdash; Ordina JWorks Tech Blog</title>
    

        <!-- Styles -->
    <!-- Font awesome CSS -->
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <!-- Magnific Popup -->
    <link href="/css/magnific-popup.css" rel="stylesheet">
    <!-- Owl carousel -->
    <link href="/css/owl.carousel.css" rel="stylesheet">

    <!-- CSS for this page -->

    <!-- Syntax highlighting -->
    <link href="/css/syntax.css" rel="stylesheet">


    <!--[if lte IE 8]>
    <script src="/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/css/main.css"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/css/ie9.css"/><![endif]-->
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/ie8.css"/><![endif]-->

    <!-- Custom CSS. Type your CSS code in custom.css file -->
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Vertical timeline -->
	<link rel="stylesheet" href="/css/vertical-timeline/style.css"> <!-- Resource style -->

    <!-- Favicon -->
    <link rel="shortcut icon" href="#">

    <script src="https://use.typekit.net/gzh0mbm.js"></script>
    <script>
        try {
            Typekit.load({async: true});
        } catch (e) {
        }
    </script>
</head>

<body>
<div id="header-image"></div>


<!-- Page Wrapper -->
<div id="page-wrapper">

        <!-- Header -->
    <header id="header">
        <h1>
            <a href="/">
                JWorks Tech Blog
            </a>
        </h1>

        <nav>
            <a href="#menu">Menu</a>
            <form action="/search/" method="get" class="header-search search-form">
                <input type="text" id="search-box-header" name="query" placeholder="Search &hellip;">
            </form>
        </nav>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <div class="inner">
            <h2>Menu</h2>
            <ul class="links">
                <li class="menu-item"><a href="/">Home</a></li>
                <li class="menu-item"><a href="/about">About Us</a></li>
                <li class="menu-item"><a href="/meet-the-team">Meet the team</a></li>
                <li class="menu-item"><a href="/jobs">Jobs</a></li>
                <li class="menu-item"><a href="/search">Search</a></li>
                <li class="menu-item"><a href="https://join.ordina-jworks.io/">JOIN</a></li>
                <li class="menu-item"><a href="/contact">Contact Us</a></li>
            </ul>
            <a href="#" class="close">Close</a>
        </div>
    </nav>

    <section id="banner">
        <header>
            <div class="inner">
                

                <h2>SSE with HTTP2</h2>
                

                
                    Posted Apr 23, 2021


    in <a href="/categories/event-driven/">Event-Driven</a>



    by
    
        <a href="/author/jago_staes/">Jago Staes</a>
        
    



    <br/>
    <i class="fa fa-tags"></i>
    
        <a href="/tags/spring/">spring</a>, 
    
        <a href="/tags/event-driven/">event-driven</a>, 
    
        <a href="/tags/server-sent-events/">server-sent-events</a>, 
    
        <a href="/tags/cloud-native/">cloud-native</a>, 
    
        <a href="/tags/http/">http</a>
    

                

                

            </div>
        </header>
    </section>


    <section id="wrapper">
        <div class="inner">
            <section id="one" class="wrapper spotlight style1 post-body">
    <div class="inner" style="text-align: left;">
        <div class="content">
            <h1 id="table-of-contents">Table Of Contents</h1>

<ul>
  <li><a href="#what-are-server-sent-events">What are Server-Sent Events?</a></li>
  <li><a href="#why-sse-over-websockets">Why SSE over Websockets?</a></li>
  <li><a href="#http11-vs-http2">HTTP/1.1 vs HTTP/2</a></li>
  <li><a href="#summary">Summary</a></li>
  <li><a href="#demo-application">Demo application</a></li>
</ul>

<h1 id="what-are-server-sent-events">What are Server-Sent Events?</h1>
<p>Server-Sent Events is a technology where the client receives data (events) pushed by a server over HTTP.
This data can be a random update (for example a tweet) or a constant stream of data (stock market price updates).
The main thing to note is that the client does not need to poll for this data. There is no communication required from client to server.
This technology may have been overshadowed by WebSockets because of SSE limitations in the past, 
but as you will see and learn in this blogpost, you have nothing to worry about anymore!</p>

<h1 id="why-sse-over-websockets">Why SSE over WebSockets?</h1>
<p>While it is true that WebSockets have more capabilities than SSE, when these capabilities are not part of your use case, SSE in my opinion is a much better choice. 
With Websockets, you have the ability to communicate from your client to the server.
But you are going to have to take care of this connection yourself.
One of the implications is that the connection needs to be  <strong>stateful</strong>, which is a pretty important thing to take into consideration when you are trying to build cloud-native applications.
WebSockets are also more supported by older browsers than SSE but this is easily solved by using the <strong>JavaScript EventSource interface</strong> to create your own connection to the server and receive the data that way.
I will demonstrate how easy it is to use this interface and solve this issue while building the demo application at the end of the blog post.</p>

<p style="text-align: center;"><img src="/img/2021-04-23-SSE-HTTP2/SSE-vs-WS.png" alt="Workspace" class="image" style="margin:0px auto; max-width:70%" /></p>

<h1 id="but-then-why-use-sse">But then why use SSE?</h1>
<p>One of the key differences between SSE and WS is that SSE uses simple HTTP to send data to the clients.
This means it does not require a special protocol like STOMP or MQTT which in turn requires server implementation to get it working making SSE a lot easier to set up.
SSE also has built-in support for reestablishing connections and event IDs which WS lacks by design.</p>

<p>So the main questions you have to ask yourself is whether your use-case fits into the whole SSE story?
Is it OK to have no communication back to the server?
Is the application you are trying to build supposed to be used in a cloud-native environment and if so will a stateful connection between client and server be a problem?
These questions will hopefully help make your choice between Server-sent Events and WebSockets easier.</p>

<h1 id="http11-vs-http2">HTTP/1.1 vs HTTP/2</h1>
<p>HTTP/1.1 is an old protocol, it loads requests one-by-one over a single TCP connection or in parallel over multiple TCP connections in an effort to decrease loading times while requiring more resources.
This was fine when this protocol was new, about 23 years ago, but as time goes by and webpages become more advanced, the limitations of this protocol are really starting to show.
This is why HTTP/2 was made, it aims to tackle the limitations set by HTTP/1.1 and be more future-proof.</p>

<p>With HTTP/2, multiple requests can be sent over the same TCP connection with responses arriving out of order.
HTTP/2 is a binary protocol, removing security issues and error-proneness that come with text-based protocols.
It is backward compatible with earlier versions of the protocol and is compatible with almost all browsers.
HTTP/2 also avoids the round trip to the server by having the server intuitively sending resources that will be required to render the page.
All these advantages eliminate the need for developers to write best practice workarounds to deal with the limitations of older versions of the protocol,
they decrease loading times and improve the website infrastructure.
This on top of full backward compatibility makes the choice between HTTP/1.1 and HTTP/2 for Server-sent events a no-brainer.</p>

<p style="text-align: center;"><img src="/img/2021-04-23-SSE-HTTP2/HTTP1-vs-HTTP2.png" alt="Workspace" class="image" style="margin:0px auto; max-width:70%" /></p>

<h1 id="summary">Summary</h1>
<p>The key takeaways in choosing WS or SSE are entirely dependent on the use-case of the application you are trying to develop.
If you are looking for a stateless approach, or you don’t have a need for client-to-server communication, SSE might be the solution for you!
The other takeaway is that you should definitely use HTTP/2 to get the most out of your application and not run into the limitations that HTTP/1.1 lays upon SSE.</p>

<p>If after reading this blogpost you have come to the conclusion that you would be better off building a Websocket application to fit your use-case you can read through a blog post on WebSockets made by my colleague Kevin Van Houtte <a href="https://ordina-jworks.github.io/event-driven/2020/06/30/user-feedback-websockets.html" target="_blank" rel="noopener noreferrer">here</a>.</p>

<h1 id="demo-application">Demo application</h1>
<p>In this part of the blogpost I am going to show you how easy it is to develop your own SSE application.</p>

<h3 id="the-use-case">The use-case</h3>
<p>We are going to build a Spring Boot application that consumes a Chuck Norris joke REST API and uses Flux to push joke data from the server using Server-Sent events to any clients that are subscribed.</p>

<h1 id="the-sse-server">The SSE server</h1>

<h3 id="pomxml">pom.xml</h3>
<p>To start off we are going to make a Spring Boot application and add the following Maven dependencies:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-webflux<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h3 id="chucknorrisjokejava">ChuckNorrisJoke.java</h3>
<p>Now we are going to add our data model, as explained in the use-case this will be a simple Chuck Norris joke object containing a String value.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChuckNorrisJoke</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="jokeservicejava">JokeService.java</h3>
<p>The next step is to get the joke data by consuming a public <a href="https://api.chucknorris.io/" target="_blank" rel="noopener noreferrer">Chuck Norris joke API</a>.
First we create a <code class="language-plaintext highlighter-rouge">JokeService</code> interface and implementation:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">JokeService</span> <span class="o">{</span>
    <span class="nc">ChuckNorrisJoke</span> <span class="nf">getRandomChuckNorrisJoke</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpHeaders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.client.RestTemplate</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JokeServiceImpl</span>  <span class="kd">implements</span> <span class="nc">JokeService</span><span class="o">{</span>

    <span class="kd">private</span> <span class="nc">RestTemplate</span> <span class="n">restTemplate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">HttpHeaders</span> <span class="n">httpHeaders</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">chuckNorrisJokeUrl</span> <span class="o">=</span> <span class="s">"https://api.chucknorris.io/jokes/random"</span><span class="o">;</span>

    <span class="nc">JokeServiceImpl</span><span class="o">(</span><span class="nc">RestTemplate</span> <span class="n">restTemplate</span><span class="o">,</span> <span class="nc">HttpHeaders</span> <span class="n">httpHeaders</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">restTemplate</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">httpHeaders</span> <span class="o">=</span> <span class="n">httpHeaders</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ChuckNorrisJoke</span> <span class="nf">getRandomChuckNorrisJoke</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ChuckNorrisJoke</span> <span class="n">joke</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ChuckNorrisJoke</span><span class="o">();</span>
        <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ChuckNorrisJoke</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">chuckNorrisJokeUrl</span><span class="o">,</span>
                <span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span>
                <span class="k">new</span> <span class="nc">HttpEntity</span><span class="o">&lt;&gt;(</span><span class="n">httpHeaders</span><span class="o">),</span>
                <span class="nc">ChuckNorrisJoke</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">hasBody</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">joke</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getBody</span><span class="o">().</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">joke</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="serverconfigjava">ServerConfig.java</h3>
<p>The <code class="language-plaintext highlighter-rouge">RestTemplate</code> and <code class="language-plaintext highlighter-rouge">HttpHeaders</code> beans are defined in the ServerConfig class as follows:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.boot.web.client.RestTemplateBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.CacheControl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.MediaType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.client.RestTemplate</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.http.HttpHeaders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.Duration</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RestTemplate</span> <span class="nf">restTemplate</span><span class="o">(</span><span class="nc">RestTemplateBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">builder</span>
                <span class="o">.</span><span class="na">setConnectTimeout</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">10000</span><span class="o">))</span>
                <span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">10000</span><span class="o">))</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nc">HttpHeaders</span> <span class="nf">httpHeaders</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">HttpHeaders</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpHeaders</span><span class="o">();</span>
        <span class="n">headers</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">HttpHeaders</span><span class="o">.</span><span class="na">ACCEPT</span><span class="o">,</span> <span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_VALUE</span><span class="o">);</span>
        <span class="n">headers</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="nc">HttpHeaders</span><span class="o">.</span><span class="na">CACHE_CONTROL</span><span class="o">,</span> <span class="nc">CacheControl</span><span class="o">.</span><span class="na">noCache</span><span class="o">().</span><span class="na">cachePrivate</span><span class="o">().</span><span class="na">mustRevalidate</span><span class="o">().</span><span class="na">getHeaderValue</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">headers</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="jokecontroller">JokeController</h3>
<p>Now for the final part of the Java code, all we have to do is create an endpoint for clients to subscribe to and push the joke data to this endpoint.
For this we are going to create a JokeController and use a Flux which is a Reactive Stream publisher to periodically emit Server-Sent events containing ChuckNorrisJokes to this endpoint.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.http.codec.ServerSentEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">reactor.core.publisher.Flux</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.time.Duration</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"sse-server"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JokeController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JokeService</span> <span class="n">jokeService</span><span class="o">;</span>

    <span class="nc">JokeController</span><span class="o">(</span><span class="nc">JokeService</span> <span class="n">jokeService</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jokeService</span> <span class="o">=</span> <span class="n">jokeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/chuck-norris-joke-stream"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">ServerSentEvent</span><span class="o">&lt;</span><span class="nc">ChuckNorrisJoke</span><span class="o">&gt;&gt;</span> <span class="nf">streamJokes</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">sequence</span> <span class="o">-&gt;</span> <span class="nc">ServerSentEvent</span><span class="o">.&lt;</span><span class="nc">ChuckNorrisJoke</span><span class="o">&gt;</span><span class="n">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">data</span><span class="o">(</span><span class="n">jokeService</span><span class="o">.</span><span class="na">getRandomChuckNorrisJoke</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>When we run our application and go to <a href="http://localhost:8080/sse-server/chuck-norris-joke-stream" target="_blank" rel="noopener noreferrer">http://localhost:8080/sse-server/chuck-norris-joke-stream</a> you can see data coming in every 5 seconds.</p>

<h1 id="the-web-client">The web client</h1>
<p>Now all that’s left to do is use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource" target="_blank" rel="noopener noreferrer">JavaScript EventSource interface</a> to open a connection to our SSE server and transform the events into text to display in our basic HTML demo page.</p>

<h3 id="indexhtml">index.html</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Server-sent events app<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/app.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"main-content"</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"jokes"</span> <span class="na">class=</span><span class="s">"table table-striped"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;th&gt;</span>Chuck Norris Jokes<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/table&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="appjs">app.js</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">eventSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventSource</span><span class="p">(</span><span class="dl">'</span><span class="s1">sse-server/chuck-norris-joke-stream</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">joke</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">showJoke</span><span class="p">(</span><span class="nx">joke</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showJoke</span><span class="p">(</span><span class="nx">joke</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">jokes</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">insertRow</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">cell</span> <span class="o">=</span> <span class="nx">row</span><span class="p">.</span><span class="nx">insertCell</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="nx">cell</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">joke</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="result">Result</h2>
<p>I will leave the styling up to you but you should now have a working SSE server and client that receives data in the form of Server-Sent events.
All that is left to do for you is to enable HTTP2 by adding <code class="language-plaintext highlighter-rouge">server.http2.enabled=true</code> to your application.properties file and to enable HTTPS the way you would do it in any Spring Boot application.</p>

<p style="text-align: center;"><img src="/img/2021-04-23-SSE-HTTP2/jokes.gif" alt="Workspace" class="image" style="margin:0px auto; max-width:100%" /></p>

<h1 id="one-final-note">One final note</h1>
<p>You can find the code for this application using HTTP/1.1 and HTTP/2 as well as an example to achieve the same thing using Websockets on my <a href="https://github.com/jagostaes/sse-servers" target="_blank" rel="noopener noreferrer">github</a>.
If you have any questions regarding this topic you can reach out to me on my <a href="https://twitter.com/jagostaes" target="_blank" rel="noopener noreferrer">Twitter</a> and I will try my best to help you out.</p>

        </div>
    </div>
    <div class="share-page" >
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://ordina-jworks.github.io/event-driven/2021/04/23/SSE-with-HTTP2.html&title=SSE with HTTP2&source=https://ordina-jworks.github.io" rel="nofollow" target="_blank" title="Share on LinkedIN">
            <img src="/img/social-media/LinkedIn.png"
                 alt="Share on LinkedIn" />
        </a>
        <a href="https://twitter.com/intent/tweet?text=SSE with HTTP2&url=https://ordina-jworks.github.io/event-driven/2021/04/23/SSE-with-HTTP2.html&via=lifeatordinabe&related=lifeatordinabe" rel="nofollow" target="_blank" title="Share on Twitter">
            <img src="/img/social-media/Twitter.png"
                 alt="Share on Twitter" />
        </a>
        <a href="https://facebook.com/sharer.php?u=https://ordina-jworks.github.io/event-driven/2021/04/23/SSE-with-HTTP2.html" rel="nofollow" target="_blank" title="Share on Facebook">
            <img src="/img/social-media/Facebook.png"
                 alt="Share on Facebook" />
        </a>
    </div>
        
</section>


<section id="two" class="wrapper alt spotlight style2">
    
    <div class="inner">
        <a href="/author/jago_staes/" class="image spotlight-image" title="">
            <img src="/img/author/jago-staes.jpg"
                 alt="" class="p-image"/>
        </a>

        <div class="content">
            
            <p><p>Jago Staes is a Java Consultant with a strong interest for Spring Boot projects, enjoys learning about new technologies and wants to learn more about frontend technologies and microservices.</p>
</p>
            
        </div>
    </div>
    
</section>

        </div>
    </section>
</div>



<footer>
    <div class="contact">
        <div class="address">
            <div class="icon"><i class="fa fa-fw fa-home"></i></div>
            <div class="text">Ordina Belgium<br/>Blarenberglaan 3B,<br/>2800 Mechelen, Belgium</div>
        </div>
        <div class="phone">
            <div class="icon"><i class="fa fa-fw fa-phone"></i></div>
            <div class="text"><a href="tel:003215295858">+32 15 29 58 58</a></div>
        </div>
        <div class="email">
            <div class="icon"><i class="fa fa-fw fa-envelope-o"></i></div>
            <div class="text"><a href="mailto:jworks@ordina.be">jworks@ordina.be</a></div>
        </div>
    </div>
    <ul class="social">
        <li>
            <a href="https://twitter.com/lifeatordinabe" target="_blank">
                <i class="fa fa-fw fa-twitter"></i><span>Twitter</span>
            </a>
        </li>
        <li>
            <a href="https://www.facebook.com/lifeatordinabe" target="_blank">
                <i class=" fa fa-fw fa-facebook"></i><span>Facebook</span>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/company/ordinabelgium" target="_blank">
                <i class=" fa fa-fw fa-linkedin"></i><span>LinkedIn</span>
            </a>
        </li>
        <li>
            <a href="/youtube" target="_blank">
                <i class=" fa fa-fw fa-youtube"></i><span>YouTube</span>
            </a>
        </li>
        <li>
            <a href="/github" target="_blank">
                <i class=" fa fa-fw fa-github"></i><span>GitHub</span>
            </a>
        </li>
        <li>
            <a href="/feed.xml" target="_blank">
                <i class=" fa fa-fw fa-rss"></i><span>RSS Feed</span>
            </a>
        </li>
    </ul>
    <div class="copyright">
        &copy; 2023 Ordina JWorks. All rights reserved.
        <br /> Disclaimer: Opinions expressed on this blog reflect the writer's views and not the position of Ordina
        <img id="analyticsImg" src="" width="1" height="1" style="border: 0px"/>
    </div>
</footer>
<!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollex.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/jquery.pin.min.js"></script>
<script src="/js/util.js"></script>
<!--[if lte IE 8]>
<script src="/js/ie/respond.min.js"></script><![endif]-->


<script>
    var imageHref = "/img/2021-04-23-SSE-HTTP2/SSE-HTTP2.png";
    $(function () {
        $('body').addClass('toggle');
    });
</script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o);
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-70040502-1', 'auto');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
    window.addEventListener('load', function () {
        if (window.ga && ga.create) {
            console.log('GA loaded correctly');
        } else {
            console.log('GA is blocked or failed to load - tracking manually...')
            document.getElementById('analyticsImg').src = 'https://jworks-techblog-analytics.cfapps.io/collect?title=' + document.title;
        }
    }, false);
</script>

<!-- Vertical timeline -->
<script src="/js/vertical-timeline/modernizr.js"></script>
<script src="/js/vertical-timeline/main.js"></script>


</body>
</html>
