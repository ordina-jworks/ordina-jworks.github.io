<!DOCTYPE html>
<!--suppress ALL -->
<html>
<head>
        <meta charset="utf-8">
    <meta name="description" content="We build innovative solutions with Java and JavaScript. To support this mission, we have several Competence Centers. From within those Competence Centers, we provide coaching to the employee and expert advice towards our customer. In order to keep in sync with the latest technologies and the latest trends, we frequently visit conferences around the globe.
">
    <meta name="keywords" content="Ordina,ORAJ,JWorks,Blog,Java,JavaScript,TypeScript,Angular,DevOps">
    <meta name="author" content="Ordina Belgium">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/img/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/img/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/favicons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-128.png" sizes="128x128" />

    

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="RDS IAM Authentication with Spring Boot - secure password-less database authentication on AWS - Yolan Vloeberghs">
    <meta name="twitter:description" content="Ordina JWorks Tech Blog">
    <meta name="twitter:image" content="http://ordina-jworks.github.io/img/2022-06-13-aws-rds-iam-authentication-spring-boot.jpeg"/>

    <!-- Facebook Open Graph -->
    <meta property="og:url" content="http://ordina-jworks.github.io/cloud/2022/06/13/aws-rds-iam-authentication-spring-boot.html"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="RDS IAM Authentication with Spring Boot - secure password-less database authentication on AWS - Yolan Vloeberghs"/>
    <meta property="og:description" content="Ordina JWorks Tech Blog"/>
    <meta property="og:image" content="http://ordina-jworks.github.io/img/2022-06-13-aws-rds-iam-authentication-spring-boot.jpeg"/>

    
    <title>RDS IAM Authentication with Spring Boot - secure password-less database authentication on AWS - Yolan Vloeberghs &mdash; Ordina JWorks Tech Blog</title>
    

        <!-- Styles -->
    <!-- Font awesome CSS -->
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <!-- Magnific Popup -->
    <link href="/css/magnific-popup.css" rel="stylesheet">
    <!-- Owl carousel -->
    <link href="/css/owl.carousel.css" rel="stylesheet">

    <!-- CSS for this page -->

    <!-- Syntax highlighting -->
    <link href="/css/syntax.css" rel="stylesheet">


    <!--[if lte IE 8]>
    <script src="/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/css/main.css"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/css/ie9.css"/><![endif]-->
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/ie8.css"/><![endif]-->

    <!-- Custom CSS. Type your CSS code in custom.css file -->
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Vertical timeline -->
	<link rel="stylesheet" href="/css/vertical-timeline/style.css"> <!-- Resource style -->

    <!-- Favicon -->
    <link rel="shortcut icon" href="#">

    <script src="https://use.typekit.net/gzh0mbm.js"></script>
    <script>
        try {
            Typekit.load({async: true});
        } catch (e) {
        }
    </script>
</head>

<body>
<div id="header-image"></div>


<!-- Page Wrapper -->
<div id="page-wrapper">

        <!-- Header -->
    <header id="header">
        <h1>
            <a href="/">
                JWorks Tech Blog
            </a>
        </h1>

        <nav>
            <a href="#menu">Menu</a>
            <form action="/search/" method="get" class="header-search search-form">
                <input type="text" id="search-box-header" name="query" placeholder="Search &hellip;">
            </form>
        </nav>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <div class="inner">
            <h2>Menu</h2>
            <ul class="links">
                <li class="menu-item"><a href="/">Home</a></li>
                <li class="menu-item"><a href="/about">About Us</a></li>
                <li class="menu-item"><a href="/meet-the-team">Meet the team</a></li>
                <li class="menu-item"><a href="/jobs">Jobs</a></li>
                <li class="menu-item"><a href="/search">Search</a></li>
                <li class="menu-item"><a href="https://join.ordina-jworks.io/">JOIN</a></li>
                <li class="menu-item"><a href="/contact">Contact Us</a></li>
            </ul>
            <a href="#" class="close">Close</a>
        </div>
    </nav>

    <section id="banner">
        <header>
            <div class="inner">
                

                <h2>RDS IAM Authentication with Spring Boot - secure password-less database authentication on AWS</h2>
                

                
                    Posted Jun 13, 2022


    in <a href="/categories/cloud/">Cloud</a>



    by
    
        <a href="/author/yolan-vloeberghs/">Yolan Vloeberghs</a>
        
    



    <br/>
    <i class="fa fa-tags"></i>
    
        <a href="/tags/spring-boot/">Spring Boot</a>, 
    
        <a href="/tags/aws/">AWS</a>, 
    
        <a href="/tags/spring/">Spring</a>, 
    
        <a href="/tags/security/">Security</a>
    

                

                

            </div>
        </header>
    </section>


    <section id="wrapper">
        <div class="inner">
            <section id="one" class="wrapper spotlight style1 post-body">
    <div class="inner" style="text-align: left;">
        <div class="content">
            <ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#database-role-grant">Database role grant</a></li>
  <li><a href="#aws">AWS</a></li>
  <li><a href="#spring-boot">Spring Boot</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="introduction">Introduction</h2>
<p>Database authentication in Spring Boot has traditionally always been very simple to implement and configure to your needs.
Whether it is with a custom data source, or just using the <code class="language-plaintext highlighter-rouge">spring.datasource</code> properties, it was always pretty straightforward to get a working database connection.
Handling the sensitive data such as database passwords in different environments can be tricky, but nowadays, there are enough solutions to tackle this problem in a secure and discrete way.</p>

<p>Fortunately, if you are deploying your application on the AWS cloud, you don’t have to struggle passwords anymore or need a fancy tool, because you simply don’t need a password.
You are now able to establish a database connection by authenticating through IAM. 
Note that this feature only works for MariaDB, MySQL and PostgreSQL.</p>

<p>The feature works with “authentication tokens”, which is a string of characters that is unique and generated by Amazon RDS.
One authentication token has a lifespan of 15 minutes and needs to be re-generated before or after it expires to keep the connection alive.</p>

<p>This very useful mechanic can deeply strengthen the security of your application by erasing the need of a password and therefore, destroying another opportunity to get your sensitive data in the wrong hands.</p>

<p>Note that you need to explicitly <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.Enabling.html" target="_blank" rel="noopener noreferrer">enable IAM authentication</a> before you can use this feature.</p>

<h2 id="database-role-grant">Database role grant</h2>
<p>Enabling IAM authentication alone is not enough.
When you create a new database user for your application, you also need to grant the rights to the database user to fetch an authentication token to use in the authentication process.</p>

<p>For Postgres, this can be done with the following SQL query:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="o">&lt;</span><span class="n">databaseuser</span><span class="o">&gt;</span> <span class="k">WITH</span> <span class="n">LOGIN</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="n">rds_iam</span> <span class="k">TO</span> <span class="n">databaseuser</span><span class="p">;</span>
</code></pre></div></div>

<p>For MySQL:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="o">&lt;</span><span class="n">databaseuser</span><span class="o">&gt;</span> <span class="n">IDENTIFIED</span> <span class="k">WITH</span> <span class="n">AWSAuthenticationPlugin</span> <span class="k">AS</span> <span class="s1">'RDS'</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="aws">AWS</h2>
<p>The application can only fetch a new authentication token if it has the right to do so.
Since we are running our application on an AWS environment, it only makes sense to make use of IAM roles.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
             </span><span class="s2">"rds-db:connect"</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
             </span><span class="s2">"arn:aws:rds-db:region:account-id:dbuser:DbiResourceId/db-user-name"</span><span class="w">
         </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>If you are running your application on an EC2 instance, make sure that your EC2 instance has an IAM role attached to it which explicitly gives access to the <code class="language-plaintext highlighter-rouge">rds-db:connect</code> action.
On EKS (Kubernetes for AWS), you can use <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">IAM roles for service accounts</a>.</p>

<h2 id="spring-boot">Spring Boot</h2>
<p>You will only need the <a href="https://mvnrepository.com/artifact/com.amazonaws/aws-java-sdk-rds" target="_blank" rel="noopener noreferrer">AWS SDK for RDS</a> to fetch an authentication token, which you can add as a dependency in Maven by adding the following code block:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.amazonaws<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>aws-java-sdk-rds<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.12.238<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>To achieve the token fetching in Spring Boot, I created a custom <code class="language-plaintext highlighter-rouge">HikariDataSource</code> which overrides the <code class="language-plaintext highlighter-rouge">getPassword()</code> method and used <code class="language-plaintext highlighter-rouge">RdsIamAuthTokenGenerator</code> and <code class="language-plaintext highlighter-rouge">GetIamAuthTokenRequest</code> to create a request for an authentication token from RDS.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RdsIAMDataSource</span> <span class="kd">extends</span> <span class="nc">HikariDataSource</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RdsIamAuthTokenGenerator</span> <span class="n">authTokenGenerator</span> <span class="o">=</span> <span class="nc">RdsIamAuthTokenGenerator</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">credentials</span><span class="o">(</span><span class="k">new</span> <span class="nc">DefaultAWSCredentialsProviderChain</span><span class="o">())</span>
                <span class="o">.</span><span class="na">region</span><span class="o">(</span><span class="k">new</span> <span class="nc">DefaultAwsRegionProviderChain</span><span class="o">().</span><span class="na">getRegion</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="no">URI</span> <span class="n">jdbcUri</span> <span class="o">=</span> <span class="n">parseJdbcURL</span><span class="o">(</span><span class="n">getJdbcUrl</span><span class="o">());</span>

        <span class="nc">GetIamAuthTokenRequest</span> <span class="n">iamAuthTokenRequest</span> <span class="o">=</span> <span class="nc">GetIamAuthTokenRequest</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">hostname</span><span class="o">(</span><span class="n">jdbcUri</span><span class="o">.</span><span class="na">getHost</span><span class="o">())</span>
                <span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="n">jdbcUri</span><span class="o">.</span><span class="na">getPort</span><span class="o">())</span>
                <span class="o">.</span><span class="na">userName</span><span class="o">(</span><span class="n">getUsername</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="k">return</span> <span class="n">authTokenGenerator</span><span class="o">.</span><span class="na">getAuthToken</span><span class="o">(</span><span class="n">iamAuthTokenRequest</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="no">URI</span> <span class="nf">parseJdbcURL</span><span class="o">(</span><span class="nc">String</span> <span class="n">jdbcUrl</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">jdbcUrl</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="k">return</span> <span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">uri</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p style="text-align: center; font-style: italic;">Note that for MariaDB, you do not need your own custom implementation as <a href="https://mariadb.com/kb/en/mariadb-connector-j-250-release-notes/#aws-iam" target="_blank" rel="noopener noreferrer">they have an implementation of their own</a>.</p>

<p>To make sure that our connection does not drop due to authentication failures, we are going to set the maximum lifespan for the connection (remember that authentication tokens are only valid for 15 minutes).</p>

<p>Don’t forget to set your database properties (host, port and username). 
<strong>Important note:</strong> IAM authentication to the database requires an SSL connection.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Sets the max lifetime of each connection to 840000 ms (14 minutes). After 14 minutes, the application does a new request to RDS for a fresh authentication token
</span><span class="py">spring.datasource.hikari.max-lifetime</span><span class="p">=</span><span class="s">840000</span>
<span class="c"># JDBC url with the properties 'ssl' and 'sslmode', this properties are bound to PostgreSQL instances
</span><span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:postgresql://&lt;db-instance-name&gt;.&lt;random&gt;.&lt;region&gt;.rds.amazonaws.com:&lt;port&gt;/&lt;db-name&gt;?ssl=true&amp;sslmode=require</span>
<span class="c"># Database user which has the 'rds_iam' role
</span><span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">&lt;db user&gt;</span>
</code></pre></div></div>
<p>With this implementation, the <code class="language-plaintext highlighter-rouge">getPassword()</code> method will be called every 14 minutes.</p>

<h2 id="conclusion">Conclusion</h2>
<p>Security is an important factor in many companies and environments, and this is definitely a recommended way of securely accessing your database from inside your application as it is a big improvement over the traditional username/password authentication method.
You don’t have a password, which means you don’t have to share it, so you have zero risk of exposing your password to unwanted parties. Not having a password also eliminates the need to manage passwords and to rotate passwords every now and then.
With the authentication token lifespan of 15 minutes, each generated token is secure and expires rapidly in case the token gets leaked.</p>

<p>While it is slightly more of a hassle to set it up, it is definitely worth your while to implement RDS IAM authentication, especially if you are already running your application and infrastructure on AWS.</p>

        </div>
    </div>
    <div class="share-page" >
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://ordina-jworks.github.io/cloud/2022/06/13/aws-rds-iam-authentication-spring-boot.html&title=RDS IAM Authentication with Spring Boot - secure password-less database authentication on AWS&source=https://ordina-jworks.github.io" rel="nofollow" target="_blank" title="Share on LinkedIN">
            <img src="/img/social-media/LinkedIn.png"
                 alt="Share on LinkedIn" />
        </a>
        <a href="https://twitter.com/intent/tweet?text=RDS IAM Authentication with Spring Boot - secure password-less database authentication on AWS&url=https://ordina-jworks.github.io/cloud/2022/06/13/aws-rds-iam-authentication-spring-boot.html&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter">
            <img src="/img/social-media/Twitter.png"
                 alt="Share on Twitter" />
        </a>
        <a href="https://facebook.com/sharer.php?u=https://ordina-jworks.github.io/cloud/2022/06/13/aws-rds-iam-authentication-spring-boot.html" rel="nofollow" target="_blank" title="Share on Facebook">
            <img src="/img/social-media/Facebook.png"
                 alt="Share on Facebook" />
        </a>
    </div>
        
</section>


<section id="two" class="wrapper alt spotlight style2">
    
    <div class="inner">
        <a href="/author/yolan-vloeberghs/" class="image spotlight-image" title="">
            <img src="/img/author/yolan-vloeberghs.jpg"
                 alt="" class="p-image"/>
        </a>

        <div class="content">
            
            <p><p>Yolan Vloeberghs is a Java and Cloud engineer with a sharpened focus on all things related to cloud, specifically AWS. He loves to play around with various technologies and frameworks and is very passionated and eager to learn about everything related to cloud-native development.</p>
</p>
            
        </div>
    </div>
    
</section>

        </div>
    </section>
</div>



<footer>
    <div class="contact">
        <div class="address">
            <div class="icon"><i class="fa fa-fw fa-home"></i></div>
            <div class="text">Ordina Belgium<br/>Blarenberglaan 3B,<br/>2800 Mechelen, Belgium</div>
        </div>
        <div class="phone">
            <div class="icon"><i class="fa fa-fw fa-phone"></i></div>
            <div class="text"><a href="tel:003215295858">+32 15 29 58 58</a></div>
        </div>
        <div class="email">
            <div class="icon"><i class="fa fa-fw fa-envelope-o"></i></div>
            <div class="text"><a href="mailto:jworks@ordina.be">jworks@ordina.be</a></div>
        </div>
    </div>
    <ul class="social">
        <li>
            <a href="https://www.facebook.com/lifeatordinabe" target="_blank">
                <i class=" fa fa-fw fa-facebook"></i><span>Facebook</span>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/company/ordinabelgium" target="_blank">
                <i class=" fa fa-fw fa-linkedin"></i><span>LinkedIn</span>
            </a>
        </li>
        <li>
            <a href="/youtube" target="_blank">
                <i class=" fa fa-fw fa-youtube"></i><span>YouTube</span>
            </a>
        </li>
        <li>
            <a href="/github" target="_blank">
                <i class=" fa fa-fw fa-github"></i><span>GitHub</span>
            </a>
        </li>
        <li>
            <a href="/feed.xml" target="_blank">
                <i class=" fa fa-fw fa-rss"></i><span>RSS Feed</span>
            </a>
        </li>
    </ul>
    <div class="copyright">
        &copy; 2023 Ordina JWorks. All rights reserved.
        <br /> Disclaimer: Opinions expressed on this blog reflect the writer's views and not the position of Ordina
        <img id="analyticsImg" src="" width="1" height="1" style="border: 0px"/>
    </div>
</footer>
<!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollex.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/jquery.pin.min.js"></script>
<script src="/js/util.js"></script>
<!--[if lte IE 8]>
<script src="/js/ie/respond.min.js"></script><![endif]-->


<script>
    var imageHref = "/img/2022-06-13-aws-rds-iam-authentication-spring-boot.jpeg";
    $(function () {
        $('body').addClass('toggle');
    });
</script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o);
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-70040502-1', 'auto');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
    window.addEventListener('load', function () {
        if (window.ga && ga.create) {
            console.log('GA loaded correctly');
        } else {
            console.log('GA is blocked or failed to load - tracking manually...')
            document.getElementById('analyticsImg').src = 'https://jworks-techblog-analytics.cfapps.io/collect?title=' + document.title;
        }
    }, false);
</script>

<!-- Vertical timeline -->
<script src="/js/vertical-timeline/modernizr.js"></script>
<script src="/js/vertical-timeline/main.js"></script>


</body>
</html>
