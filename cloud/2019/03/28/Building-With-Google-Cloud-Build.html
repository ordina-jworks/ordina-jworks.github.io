<!DOCTYPE html>
<!--suppress ALL -->
<html>
<head>
        <meta charset="utf-8">
    <meta name="description" content="We build innovative solutions with Java and JavaScript. To support this mission, we have several Competence Centers. From within those Competence Centers, we provide coaching to the employee and expert advice towards our customer. In order to keep in sync with the latest technologies and the latest trends, we frequently visit conferences around the globe.
">
    <meta name="keywords" content="Ordina,ORAJ,JWorks,Blog,Java,JavaScript,TypeScript,Angular,DevOps">
    <meta name="author" content="Ordina Belgium">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/img/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/img/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/favicons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-128.png" sizes="128x128" />

    

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Building with Google Cloud Build - Tom Verelst">
    <meta name="twitter:description" content="Ordina JWorks Tech Blog">
    <meta name="twitter:image" content="http://ordina-jworks.github.io/img/2019-03-28-cloudbuild/cloudbuild.png"/>

    <!-- Facebook Open Graph -->
    <meta property="og:url" content="http://ordina-jworks.github.io/cloud/2019/03/28/Building-With-Google-Cloud-Build.html"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Building with Google Cloud Build - Tom Verelst"/>
    <meta property="og:description" content="Ordina JWorks Tech Blog"/>
    <meta property="og:image" content="http://ordina-jworks.github.io/img/2019-03-28-cloudbuild/cloudbuild.png"/>

    
    <title>Building with Google Cloud Build - Tom Verelst &mdash; Ordina JWorks Tech Blog</title>
    

        <!-- Styles -->
    <!-- Font awesome CSS -->
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <!-- Magnific Popup -->
    <link href="/css/magnific-popup.css" rel="stylesheet">
    <!-- Owl carousel -->
    <link href="/css/owl.carousel.css" rel="stylesheet">

    <!-- CSS for this page -->

    <!-- Syntax highlighting -->
    <link href="/css/syntax.css" rel="stylesheet">


    <!--[if lte IE 8]>
    <script src="/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/css/main.css"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/css/ie9.css"/><![endif]-->
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/ie8.css"/><![endif]-->

    <!-- Custom CSS. Type your CSS code in custom.css file -->
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Vertical timeline -->
	<link rel="stylesheet" href="/css/vertical-timeline/style.css"> <!-- Resource style -->

    <!-- Favicon -->
    <link rel="shortcut icon" href="#">

    <script src="https://use.typekit.net/gzh0mbm.js"></script>
    <script>
        try {
            Typekit.load({async: true});
        } catch (e) {
        }
    </script>
</head>

<body>
<div id="header-image"></div>


<!-- Page Wrapper -->
<div id="page-wrapper">

        <!-- Header -->
    <header id="header">
        <h1>
            <a href="/">
                JWorks Tech Blog
            </a>
        </h1>

        <nav>
            <a href="#menu">Menu</a>
            <form action="/search/" method="get" class="header-search search-form">
                <input type="text" id="search-box-header" name="query" placeholder="Search &hellip;">
            </form>
        </nav>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <div class="inner">
            <h2>Menu</h2>
            <ul class="links">
                <li class="menu-item"><a href="/">Home</a></li>
                <li class="menu-item"><a href="/about">About Us</a></li>
                <li class="menu-item"><a href="/meet-the-team">Meet the team</a></li>
                <li class="menu-item"><a href="/jobs">Jobs</a></li>
                <li class="menu-item"><a href="/search">Search</a></li>
                <li class="menu-item"><a href="https://join.ordina-jworks.io/">JOIN</a></li>
                <li class="menu-item"><a href="/contact">Contact Us</a></li>
            </ul>
            <a href="#" class="close">Close</a>
        </div>
    </nav>

    <section id="banner">
        <header>
            <div class="inner">
                

                <h2>Building with Google Cloud Build</h2>
                

                
                    Posted Mar 28, 2019


    in <a href="/categories/cloud/">Cloud</a>



    by
    
        <a href="/author/tom-verelst/">Tom Verelst</a>
        
    



    <br/>
    <i class="fa fa-tags"></i>
    
        <a href="/tags/gcp/">GCP</a>, 
    
        <a href="/tags/docker/">Docker</a>, 
    
        <a href="/tags/devops/">DevOps</a>, 
    
        <a href="/tags/git/">Git</a>, 
    
        <a href="/tags/kubernetes/">Kubernetes</a>
    

                

                

            </div>
        </header>
    </section>


    <section id="wrapper">
        <div class="inner">
            <section id="one" class="wrapper spotlight style1 post-body">
    <div class="inner" style="text-align: left;">
        <div class="content">
            <p>In this post, 
we will have a quick overview on what is possible with Google Cloud Build.</p>

<p>Google Cloud Build is a fully managed solution for building containers or other artifacts.
It can integrate with Google Storage, Cloud Source Repositories, GitHub and BitBucket.</p>

<h2 id="a-simple-yaml-file">A simple YAML file</h2>

<p>We can easily set up a build pipeline using a YAML file which we store in our source code repository.
Each build step is defined using a container image and passing arguments to it.
Here is an example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>steps:
  # Test Helm templates
  - name: 'quay.io/helmpack/chart-testing:v2.2.0'
    id: 'Helm Lint'
    args: ['ct', 'lint', '--all', '--chart-dirs', '/workspace/helm', '--validate-maintainers=false']

  # Build image
  - name: 'gcr.io/cloud-builders/docker'
    id: 'Building image'
    args: ['build', '-t', 'eu.gcr.io/$PROJECT_ID/cloud-build-demo:$COMMIT_SHA', '.']

  # Create custom image tag and write to file /workspace/_TAG
  - name: 'ubuntu'
    id: 'Setup'
    args: ['bash', '-c', "echo `echo $BRANCH_NAME | sed 's,/,-,g' | awk '{print tolower($0)}'`_$(date -u +%Y%m%dT%H%M)_$SHORT_SHA &gt; _TAG; echo $(cat _TAG)"]

  # Tag image with custom tag
  - name: 'gcr.io/cloud-builders/docker'
    id: 'Tagging image'
    entrypoint: '/bin/bash'
    args: ['-c', "docker tag eu.gcr.io/$PROJECT_ID/cloud-build-demo:$COMMIT_SHA eu.gcr.io/$PROJECT_ID/ms-map-report:$(cat _TAG)"]
images: ['eu.gcr.io/$PROJECT_ID/cloud-build-demo']
timeout: 15m
options:
  machineType: 'N1_HIGHCPU_8'
</code></pre></div></div>

<p>We are free to use any image that we like.
Cloud Build already <a href="https://cloud.google.com/cloud-build/docs/cloud-builders" target="_blank" rel="noopener noreferrer">provides a set of base images (called Cloud Builders)</a>,
including images for Maven, Git, Docker, Bazel, npm, gcloud, kubectl, etc.</p>

<p>We can also customise some build options like the timeout of the build,
or on which kind of node the build runs.
Pricing is done based on the amount of build minutes. 
However, 
if we use the default node, 
the first 120 build minutes are free every day!</p>

<p>If the build finishes successfully,
Cloud Build will automatically upload the built images to the container registry.
This is based on the images defined in the <code class="language-plaintext highlighter-rouge">images</code> array.</p>

<p>Data usually needs be shared between steps.
We might want to download dependencies in one step,
and build your artifact in another step,
or run tests in a separate step.
Google has provided a simple solution for this.
Each build step has access to the <code class="language-plaintext highlighter-rouge">/workspace</code> folder, 
which is mounted on the container of each step.
Each build has access to its own workspace folder,
which is deleted automatically after the build finishes.</p>

<p>In the above example, 
a custom Docker tag is created and saved to the <code class="language-plaintext highlighter-rouge">/workspace/_TAG</code> file,
and then read from again in the next step.</p>

<p>To start the build, 
we can use the <code class="language-plaintext highlighter-rouge">gcloud builds submit</code> command,
or create an automatic trigger on the Google Cloud console that triggers the build on new commits in the Git repository.
After adding a trigger, 
we can also trigger the build manually in the Google Cloud console.</p>

<h2 id="build-parameters-substitutions">Build parameters (substitutions)</h2>

<p>It is possible to pass in parameters (called substitutions) to our build.</p>

<p>We can override substitutions when submitting a build:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ gcloud builds submit --config=cloudbuild.yaml \
     --substitutions=TAG_NAME="test"
</code></pre></div></div>

<p>Cloud Build provides the following default substitutions:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">$PROJECT_ID</code>: <code class="language-plaintext highlighter-rouge">build.ProjectId</code></li>
  <li><code class="language-plaintext highlighter-rouge">$BUILD_ID</code>: <code class="language-plaintext highlighter-rouge">build.BuildId</code></li>
  <li><code class="language-plaintext highlighter-rouge">$COMMIT_SHA</code>: <code class="language-plaintext highlighter-rouge">build.SourceProvenance.ResolvedRepoSource.Revision.CommitSha</code> (only available for triggered builds)</li>
  <li><code class="language-plaintext highlighter-rouge">$SHORT_SHA</code> : The first seven characters of <code class="language-plaintext highlighter-rouge">COMMIT_SHA</code> (only available for triggered builds)</li>
  <li><code class="language-plaintext highlighter-rouge">$REPO_NAME</code>: <code class="language-plaintext highlighter-rouge">build.Source.RepoSource.RepoName</code> (only available for triggered builds)</li>
  <li><code class="language-plaintext highlighter-rouge">$BRANCH_NAME</code>: <code class="language-plaintext highlighter-rouge">build.Source.RepoSource.Revision.BranchName</code> (only available for triggered builds)</li>
  <li><code class="language-plaintext highlighter-rouge">$TAG_NAME</code>: <code class="language-plaintext highlighter-rouge">build.Source.RepoSource.Revision.TagName</code> (only available for triggered builds)</li>
  <li><code class="language-plaintext highlighter-rouge">$REVISION_ID</code>: <code class="language-plaintext highlighter-rouge">build.SourceProvenance.ResolvedRepoSource.Revision.CommitSha</code> (only available for triggered builds)</li>
</ul>

<p>We can use <code class="language-plaintext highlighter-rouge">substitions</code> to define our own custom parameters.
Note that the name of the substitution must start with an underscore (<code class="language-plaintext highlighter-rouge">_</code>),
and can only use uppercase alphanumeric characters. Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>substitutions:
    _CUSTOM_PARAM_1: foo # default value
    _CUSTOM_PARAM_2: bar # default value
images: [
    'gcr.io/$PROJECT_ID/myapp-${_CUSTOM_PARAM_1}',
    'gcr.io/$PROJECT_ID/myapp-${_CUSTOM_PARAM_2}'
]
</code></pre></div></div>

<h2 id="securing-your-build">Securing your build</h2>

<p>If we require to use credentials in our builds,
it is possible to do this securely using Google Cloud Key Management Service (KMS).
We will not go into <a href="https://cloud.google.com/kms/docs/quickstart" target="_blank" rel="noopener noreferrer">how to use and to setup KMS</a>,
but once we have set it up,
we can start encrypting our build secrets.</p>

<p>First, we will need to give Cloud Build access to KMS by adding the <strong>Cloud KMS CryptoKey Decrypter</strong> role
to our <code class="language-plaintext highlighter-rouge">...@cloudbuild.gserviceaccount.com</code> service account.</p>

<p>Encrypt our secret with KMS:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gcloud kms encrypt \
  --plaintext-file=secrets.json \
  --ciphertext-file=secrets.json.enc \
  --location=global \
  --keyring=[KEYRING-NAME] \
  --key=[KEY-NAME]
</code></pre></div></div>

<p>This will create an encrypted file which we can add to our application’s source code.
Using KMS, we can decrypt this secret in our Cloud Build pipeline:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>steps:
- name: gcr.io/cloud-builders/gcloud
  args:
  - kms
  - decrypt
  - --ciphertext-file=secrets.json.enc
  - --plaintext-file=secrets.json
  - --location=global
  - --keyring=[KEYRING-NAME]
  - --key=[KEY-NAME]
</code></pre></div></div>

<p>This will decrypt the secret into a file in our workspace folder,
which then can be used in subsequent steps.</p>

<h2 id="debugging-and-running-your-build-locally">Debugging and running your build locally</h2>

<p>When creating a build pipeline, 
we do not need to keep pushing our code to the source repository to trigger a build.
We can use the <code class="language-plaintext highlighter-rouge">cloud-build-local</code> tool to run our build locally,
using the Google Cloud SDK and Docker.</p>

<p>If we are using the Cloud Builder images (<code class="language-plaintext highlighter-rouge">gcr.io/cloud-builders/...</code>),
we must first configure our Google Cloud SDK to be able to pull the images:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Configure Docker
$ gcloud components install docker-credential-gcr
$ docker-credential-gcr configure-docker
</code></pre></div></div>

<p>Then install the <code class="language-plaintext highlighter-rouge">cloud-build-local</code> tool:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gcloud components install cloud-build-local
</code></pre></div></div>

<p>Now we can use the tool to test our build pipeline locally!</p>

<p>To build locally, we run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloud-build-local --config=[CONFIG FILE] \
  --dryrun=false \
  --push \
  [SOURCE_CODE]
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">CONFIG FILE</code> is our Cloud Build YAML config file</li>
  <li><code class="language-plaintext highlighter-rouge">SOURCE_CODE</code> is the path to our source code</li>
  <li><code class="language-plaintext highlighter-rouge">--dryrun=false</code> will cause our build to actually run. 
This is <code class="language-plaintext highlighter-rouge">true</code> by default and we must enable this explicitly to cause the containers to execute.</li>
  <li><code class="language-plaintext highlighter-rouge">--push</code> will cause the built images defined in <code class="language-plaintext highlighter-rouge">images</code> to be pushed to the registry.</li>
</ul>

<p>If we use some of the default substitions like <code class="language-plaintext highlighter-rouge">$COMMIT_SHA</code> in our build,
we must pass these in with the <code class="language-plaintext highlighter-rouge">--substitions</code> flag in key=value pairs,
separated by commas.
Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ cloud-build-local --config=cloud-build.yaml \
   --dryrun=false \
   --substitutions COMMIT_SHA=$(git rev-parse HEAD),BRANCH_NAME=$(git rev-parse  --abbrev-ref HEAD) \ 
   /path/to/source
</code></pre></div></div>

<p>Cloud Build stores intermediary artifacts in the workspace folder.
This workspace folder, 
as mentioned before,
will be removed after the build finishes.
If we want to debug our build and check what happened in the workspace folder,
then we can copy the artifacts to a path on our computer,
using the <code class="language-plaintext highlighter-rouge">--write-workspace</code> flag.
Note that this path must reside outside of our source folder!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloud-build-local --config=cloud-build.yaml \
   --dryrun=false \
   --write-workspace=/path/on/computer \
   /path/to/source
</code></pre></div></div>

<h2 id="build-events">Build events</h2>

<p>It is possible to trigger other actions when a build starts, finishes, or fails.
Notifications to our team’s chat,
triggering a deployment pipeline,
monitoring our build. 
These are just a few examples.
Cloud Build pushes build events to Pub/Sub on the <code class="language-plaintext highlighter-rouge">cloud-builds</code> topic.
This topic is created automatically when Cloud Build is used.</p>

<p>We can easily create a subscription on this topic. 
There are two kinds of subscriptions we can use.
The first one is a push subscription, 
which pushes the message to a HTTP endpoint you define.
In this case messages are delivered the moment the event is published on the topic.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "message": {
    "attributes": {
      "buildId": "abcd-efgh...",
      "status": "SUCCESS"
    },
    "data": "SGVsbG8gQ2xvdWQgUHViL1N1YiEgSGVyZSBpcyBteSBtZXNzYWdlIQ==",
    "message_id": "136969346945"
  },
  "subscription": "projects/myproject/subscriptions/mysubscription"
}
</code></pre></div></div>

<p>Messages that are received using a pull subscription have the following format:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "receivedMessages": [
    {
      "ackId": "dQNNHlAbEGEIBERNK0EPKVgUWQYyODM2LwgRHFEZDDsLRk1SK...",
      "message": {
        "attributes": {
          "buildId": "abcd-efgh-...",
          "status": "SUCCESS"
        },
        "data": "SGVsbG8gQ2xvdWQgUHViL1N1YiEgSGVyZSBpcyBteSBtZXNzYWdlIQ==",
        "messageId": "19917247034"
      }
    }
  ]
}
</code></pre></div></div>

<p>Each message contains the Base64 encoded event of the <a href="https://cloud.google.com/cloud-build/docs/api/reference/rest/v1/projects.builds" target="_blank" rel="noopener noreferrer">Build resource</a>.
Here is an example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "id": "a0e322f2-5d8d-4d56-a2b5-05cc18a350af",
  "projectId": "myproject",
  "status": "SUCCESS",
  "source": {
    "repoSource": {
      "projectId": "myproject",
      "repoName": "mygitrepo",
      "branchName": "feature/my-branch"
    }
  },
  "steps": [
    {
      "name": "gcr.io/cloud-builders/mvn",
      "args": [
        "mvn",
        "clean",
        "--batch-mode"
      ],
      "id": "Clean",
      "timing": {
        "startTime": "2019-03-23T15:01:25.421160679Z",
        "endTime": "2019-03-23T15:02:04.363792008Z"
      },
      "pullTiming": {
        "startTime": "2019-03-23T15:01:25.421160679Z",
        "endTime": "2019-03-23T15:01:59.834114283Z"
      },
      "status": "SUCCESS"
    },
    ... More steps
  ],
  "results": {
    "images": [
      {
        "name": "eu.gcr.io/myproject/myapp:d76cce6d732e6edc01e65a547997caf107411468",
        "digest": "sha256:0bb2f72d3d267c6bfebee8478d06dbf553d5932e01a0b86b7fc298c3a9b4a1f2",
        "pushTiming": {
          "startTime": "2019-03-23T15:15:58.377229824Z",
          "endTime": "2019-03-23T15:16:01.908997933Z"
        }
      }
    ],
    "buildStepImages": [
      "",
      "sha256:dbc62a5cd330fba4d092d83f64218f310ee1a61bdb49d889728091756bc38bac",
      "sha256:dbc62a5cd330fba4d092d83f64218f310ee1a61bdb49d889728091756bc38bac",
      "sha256:dbc62a5cd330fba4d092d83f64218f310ee1a61bdb49d889728091756bc38bac",
      "sha256:dbc62a5cd330fba4d092d83f64218f310ee1a61bdb49d889728091756bc38bac",
      "sha256:dbc62a5cd330fba4d092d83f64218f310ee1a61bdb49d889728091756bc38bac",
      "sha256:d30ca59f3315232f539955a6179f2b287445ec56db41e7d7a41a622c9faee575",
      "sha256:d30ca59f3315232f539955a6179f2b287445ec56db41e7d7a41a622c9faee575",
      "sha256:d30ca59f3315232f539955a6179f2b287445ec56db41e7d7a41a622c9faee575"
    ],
    "buildStepOutputs": []
  },
  "createTime": "2019-03-23T15:01:16.591984806Z",
  "startTime": "2019-03-23T15:01:17.438509785Z",
  "finishTime": "2019-03-23T15:16:02.968224Z",
  "timeout": "1800s",
  "images": [
    "eu.gcr.io/myproject/myapp:d76cce6d732e6edc01e65a547997caf107411468"
  ],
  "artifacts": {
    "images": [
      "eu.gcr.io/myproject/myapp:d76cce6d732e6edc01e65a547997caf107411468"
    ]
  },
  "logsBucket": "gs://199957373521.cloudbuild-logs.googleusercontent.com",
  "sourceProvenance": {
    "resolvedRepoSource": {
      "projectId": "mateco-map",
      "repoName": "bitbucket_matecocloud_myapp",
      "commitSha": "d76cce6d732e6edc01e65a547997caf107411468"
    }
  },
  "buildTriggerId": "9bd093c7-9de4-4eae-bfea-ce8e46afafa8",
  "options": {
    "substitutionOption": "ALLOW_LOOSE",
    "logging": "LEGACY"
  },
  "logUrl": "https://console.cloud.google.com/gcr/builds/a0e322f2-5c8d-4e56-a2b5-05cc18a350af?project=199957373521",
  "substitutions": {
    "_MOD_BRANCH_NAME": "$_tmpvar"
  },
  "tags": [
    "event-f2d96d7b-22f5-41d7-9ded-a98a2a6f43ca",
    "trigger-9bd093c7-9de4-4eae-bfea-ce8e46afafa8"
  ],
  "timing": {
    "BUILD": {
      "startTime": "2019-03-23T15:01:25.421114358Z",
      "endTime": "2019-03-23T15:15:58.377209942Z"
    },
    "FETCHSOURCE": {
      "startTime": "2019-03-23T15:01:20.519103589Z",
      "endTime": "2019-03-23T15:01:25.368505523Z"
    },
    "PUSH": {
      "startTime": "2019-03-23T15:15:58.377226850Z",
      "endTime": "2019-03-23T15:16:01.909032379Z"
    }
  }
}
</code></pre></div></div>

<p>Note that Cloud Build does not publish events between steps, 
but only when the build is queued, starts or ends.</p>

<table>
  <thead>
    <tr>
      <th>Event</th>
      <th>Build status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>The build is queued</td>
      <td><code class="language-plaintext highlighter-rouge">QUEUED</code></td>
    </tr>
    <tr>
      <td>The build starts</td>
      <td><code class="language-plaintext highlighter-rouge">WORKING</code></td>
    </tr>
    <tr>
      <td>The build is successful</td>
      <td><code class="language-plaintext highlighter-rouge">SUCCESS</code></td>
    </tr>
    <tr>
      <td>Build is cancelled</td>
      <td><code class="language-plaintext highlighter-rouge">CANCELLED</code></td>
    </tr>
    <tr>
      <td>Build times out</td>
      <td><code class="language-plaintext highlighter-rouge">TIMEOUT</code></td>
    </tr>
    <tr>
      <td>Step times out</td>
      <td><code class="language-plaintext highlighter-rouge">TIMEOUT</code></td>
    </tr>
    <tr>
      <td>Build failed</td>
      <td><code class="language-plaintext highlighter-rouge">FAILURE</code></td>
    </tr>
    <tr>
      <td>Internal error by Google Cloud Build</td>
      <td><code class="language-plaintext highlighter-rouge">INTERNAL_ERROR</code></td>
    </tr>
  </tbody>
</table>

<p>Using Google Cloud Function, 
we can easily trigger other actions based on these build events.</p>

<p>Here is a small, redacted snippet of a Google Cloud Function
which sends build updates to a Slack webhook.</p>

<p>It receives the build event, reads the Base64 encoded data,
converts it into a Slack message and triggers the webhook with the created message.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const IncomingWebhook = require('@slack/client').IncomingWebhook;
const SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/XXXXXXXXXXXXXX";
const WEBHOOK = new IncomingWebHook(SLACK_WEBHOOK_URL);

// Main function called by Cloud Functions.
module.exports.cloudBuildSlack = (event, callback) =&gt; {
    const build = eventToBuild(event.data.data);
    WEBHOOK.send(createSlackMessage(build), callback);
};
    
const createSlackMessage = (build) =&gt; {
    const app = getApplicationName(build);
    const branch = build.source.repoSource.branchName;
    const subject = createSubject(build);
    const tag = getImagetag(build);

    return {
        attachments: [{
            fallback: `${subject} - ${app} - ${branch} - &lt;${build.logUrl}|Logs&gt;`,
            title: subject,
            title_link: build.logUrl,
            fields: getFields(app, branch, tag),
            color: getMessageColor(build)
        }],
        mrkdwn: true
    };
};

// eventToBuild transforms pubsub event message to a build object.
const eventToBuild = (data) =&gt; {
    return JSON.parse(new Buffer(data, 'base64').toString());
};

...more functions
    
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>Cloud Build offers a simple solution and utilises the power of containers to offer a lot of possibilities.
A build pipeline is set up in a few minutes, and your Docker images are uploaded automatically!</p>

<p>It saves you a lot of time and trouble in setting up build infrastructure, 
because, well, you do not have to!</p>

<p>If you wish to try it yourself,
we have provided <a href="https://github.com/tomverelst/cloud-build-demo" target="_blank" rel="noopener noreferrer">a demo application on GitHub</a>.
Enjoy Cloud Building!</p>

        </div>
    </div>
    <div class="share-page" >
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://ordina-jworks.github.io/cloud/2019/03/28/Building-With-Google-Cloud-Build.html&title=Building with Google Cloud Build&source=https://ordina-jworks.github.io" rel="nofollow" target="_blank" title="Share on LinkedIN">
            <img src="/img/social-media/LinkedIn.png"
                 alt="Share on LinkedIn" />
        </a>
        <a href="https://twitter.com/intent/tweet?text=Building with Google Cloud Build&url=https://ordina-jworks.github.io/cloud/2019/03/28/Building-With-Google-Cloud-Build.html&via=lifeatordinabe&related=lifeatordinabe" rel="nofollow" target="_blank" title="Share on Twitter">
            <img src="/img/social-media/Twitter.png"
                 alt="Share on Twitter" />
        </a>
        <a href="https://facebook.com/sharer.php?u=https://ordina-jworks.github.io/cloud/2019/03/28/Building-With-Google-Cloud-Build.html" rel="nofollow" target="_blank" title="Share on Facebook">
            <img src="/img/social-media/Facebook.png"
                 alt="Share on Facebook" />
        </a>
    </div>
        
</section>


<section id="two" class="wrapper alt spotlight style2">
    
    <div class="inner">
        <a href="/author/tom-verelst/" class="image spotlight-image" title="">
            <img src="/img/author/tom-verelst.png"
                 alt="" class="p-image"/>
        </a>

        <div class="content">
            
            <p><p>Tom is a senior software engineer at Ordina Belgium. He is fond of all things Go and DevOps.</p>
</p>
            
        </div>
    </div>
    
</section>

        </div>
    </section>
</div>



<footer>
    <div class="contact">
        <div class="address">
            <div class="icon"><i class="fa fa-fw fa-home"></i></div>
            <div class="text">Ordina Belgium<br/>Blarenberglaan 3B,<br/>2800 Mechelen, Belgium</div>
        </div>
        <div class="phone">
            <div class="icon"><i class="fa fa-fw fa-phone"></i></div>
            <div class="text"><a href="tel:003215295858">+32 15 29 58 58</a></div>
        </div>
        <div class="email">
            <div class="icon"><i class="fa fa-fw fa-envelope-o"></i></div>
            <div class="text"><a href="mailto:jworks@ordina.be">jworks@ordina.be</a></div>
        </div>
    </div>
    <ul class="social">
        <li>
            <a href="https://twitter.com/lifeatordinabe" target="_blank">
                <i class="fa fa-fw fa-twitter"></i><span>Twitter</span>
            </a>
        </li>
        <li>
            <a href="https://www.facebook.com/lifeatordinabe" target="_blank">
                <i class=" fa fa-fw fa-facebook"></i><span>Facebook</span>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/company/ordinabelgium" target="_blank">
                <i class=" fa fa-fw fa-linkedin"></i><span>LinkedIn</span>
            </a>
        </li>
        <li>
            <a href="/youtube" target="_blank">
                <i class=" fa fa-fw fa-youtube"></i><span>YouTube</span>
            </a>
        </li>
        <li>
            <a href="/github" target="_blank">
                <i class=" fa fa-fw fa-github"></i><span>GitHub</span>
            </a>
        </li>
        <li>
            <a href="/feed.xml" target="_blank">
                <i class=" fa fa-fw fa-rss"></i><span>RSS Feed</span>
            </a>
        </li>
    </ul>
    <div class="copyright">
        &copy; 2022 Ordina JWorks. All rights reserved.
        <br /> Disclaimer: Opinions expressed on this blog reflect the writer's views and not the position of Ordina
        <img id="analyticsImg" src="" width="1" height="1" style="border: 0px"/>
    </div>
</footer>
<!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollex.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/jquery.pin.min.js"></script>
<script src="/js/util.js"></script>
<!--[if lte IE 8]>
<script src="/js/ie/respond.min.js"></script><![endif]-->


<script>
    var imageHref = "/img/2019-03-28-cloudbuild/cloudbuild.png";
    $(function () {
        $('body').addClass('toggle');
    });
</script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o);
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-70040502-1', 'auto');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
    window.addEventListener('load', function () {
        if (window.ga && ga.create) {
            console.log('GA loaded correctly');
        } else {
            console.log('GA is blocked or failed to load - tracking manually...')
            document.getElementById('analyticsImg').src = 'https://jworks-techblog-analytics.cfapps.io/collect?title=' + document.title;
        }
    }, false);
</script>

<!-- Vertical timeline -->
<script src="/js/vertical-timeline/modernizr.js"></script>
<script src="/js/vertical-timeline/main.js"></script>


</body>
</html>
