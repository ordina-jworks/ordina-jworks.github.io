<!DOCTYPE html>
<!--suppress ALL -->
<html>
<head>
        <meta charset="utf-8">
    <meta name="description" content="We build innovative solutions with Java and JavaScript. To support this mission, we have several Competence Centers. From within those Competence Centers, we provide coaching to the employee and expert advice towards our customer. In order to keep in sync with the latest technologies and the latest trends, we frequently visit conferences around the globe.
">
    <meta name="keywords" content="Ordina,ORAJ,JWorks,Blog,Java,JavaScript,TypeScript,Angular,DevOps">
    <meta name="author" content="Ordina Belgium">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/img/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/img/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/favicons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-128.png" sizes="128x128" />

    

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Snitching On Your Colleagues Using Cloud Magic - Lander Marien">
    <meta name="twitter:description" content="Ordina JWorks Tech Blog">
    <meta name="twitter:image" content="http://ordina-jworks.github.io/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/Betrayal.jpg"/>

    <!-- Facebook Open Graph -->
    <meta property="og:url" content="http://ordina-jworks.github.io/internship/2022/07/07/snitching-on-your-colleagues-using-cloud-magic.html"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Snitching On Your Colleagues Using Cloud Magic - Lander Marien"/>
    <meta property="og:description" content="Ordina JWorks Tech Blog"/>
    <meta property="og:image" content="http://ordina-jworks.github.io/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/Betrayal.jpg"/>

    
    <title>Snitching On Your Colleagues Using Cloud Magic - Lander Marien &mdash; Ordina JWorks Tech Blog</title>
    

        <!-- Styles -->
    <!-- Font awesome CSS -->
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <!-- Magnific Popup -->
    <link href="/css/magnific-popup.css" rel="stylesheet">
    <!-- Owl carousel -->
    <link href="/css/owl.carousel.css" rel="stylesheet">

    <!-- CSS for this page -->

    <!-- Syntax highlighting -->
    <link href="/css/syntax.css" rel="stylesheet">


    <!--[if lte IE 8]>
    <script src="/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/css/main.css"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/css/ie9.css"/><![endif]-->
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/ie8.css"/><![endif]-->

    <!-- Custom CSS. Type your CSS code in custom.css file -->
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Vertical timeline -->
	<link rel="stylesheet" href="/css/vertical-timeline/style.css"> <!-- Resource style -->

    <!-- Favicon -->
    <link rel="shortcut icon" href="#">

    <script src="https://use.typekit.net/gzh0mbm.js"></script>
    <script>
        try {
            Typekit.load({async: true});
        } catch (e) {
        }
    </script>
</head>

<body>
<div id="header-image"></div>


<!-- Page Wrapper -->
<div id="page-wrapper">

        <!-- Header -->
    <header id="header">
        <h1>
            <a href="/">
                JWorks Tech Blog
            </a>
        </h1>

        <nav>
            <a href="#menu">Menu</a>
            <form action="/search/" method="get" class="header-search search-form">
                <input type="text" id="search-box-header" name="query" placeholder="Search &hellip;">
            </form>
        </nav>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <div class="inner">
            <h2>Menu</h2>
            <ul class="links">
                <li class="menu-item"><a href="/">Home</a></li>
                <li class="menu-item"><a href="/about">About Us</a></li>
                <li class="menu-item"><a href="/meet-the-team">Meet the team</a></li>
                <li class="menu-item"><a href="/jobs">Jobs</a></li>
                <li class="menu-item"><a href="/search">Search</a></li>
                <li class="menu-item"><a href="https://join.ordina-jworks.io/">JOIN</a></li>
                <li class="menu-item"><a href="/contact">Contact Us</a></li>
            </ul>
            <a href="#" class="close">Close</a>
        </div>
    </nav>

    <section id="banner">
        <header>
            <div class="inner">
                

                <h2>Snitching On Your Colleagues Using Cloud Magic</h2>
                

                
                    Posted Jul 7, 2022


    in <a href="/categories/internship/">Internship</a>



    by
    
        <a href="/author/lander_marien/">Lander Marien</a>
        
    



    <br/>
    <i class="fa fa-tags"></i>
    
        <a href="/tags/spring/">Spring</a>, 
    
        <a href="/tags/spring-boot/">Spring Boot</a>, 
    
        <a href="/tags/git/">Git</a>, 
    
        <a href="/tags/devops/">DevOps</a>, 
    
        <a href="/tags/docker/">Docker</a>, 
    
        <a href="/tags/kubernetes/">Kubernetes</a>, 
    
        <a href="/tags/terraform/">Terraform</a>, 
    
        <a href="/tags/helm/">Helm</a>, 
    
        <a href="/tags/azure/">Azure</a>, 
    
        <a href="/tags/internet-of-things/">Internet Of Things</a>, 
    
        <a href="/tags/raspberrypi/">RaspberryPi</a>, 
    
        <a href="/tags/javascript/">Javascript</a>, 
    
        <a href="/tags/node.js/">Node.js</a>, 
    
        <a href="/tags/aws/">AWS</a>, 
    
        <a href="/tags/dynamodb/">DynamoDB</a>, 
    
        <a href="/tags/rds/">RDS</a>, 
    
        <a href="/tags/postgres/">Postgres</a>
    

                

                

            </div>
        </header>
    </section>


    <section id="wrapper">
        <div class="inner">
            <section id="one" class="wrapper spotlight style1 post-body">
    <div class="inner" style="text-align: left;">
        <div class="content">
            <h1 id="table-of-contents">Table Of Contents</h1>

<ul>
  <li>
    <p><a href="#introduction">Introduction</a></p>
  </li>
  <li><a href="#the-task-at-hand">The Task At Hand</a></li>
  <li><a href="#exploring-the-environment">Exploring The Environment</a>
    <ul>
      <li><a href="#azure-repos">Azure Repos</a></li>
      <li><a href="#pipeline">Pipeline</a></li>
      <li><a href="#library">Library</a></li>
      <li><a href="#service-connections">Service Connections</a></li>
    </ul>
  </li>
  <li><a href="#into-the-rabbit-hole-setting-up-the-pipeline">Into The Rabbit-Hole : Setting Up The Pipeline</a>
    <ul>
      <li><a href="#before-we-dive-in">Before We Dive In</a></li>
      <li><a href="#basic-tasks">Basic Tasks</a></li>
      <li><a href="#containerization">Containerization</a></li>
      <li><a href="#setting-up-a-cloud-database">Setting Up A Cloud Database</a></li>
      <li><a href="#provisioning-a-cloud-cluster">Provisioning A Cloud Cluster</a></li>
      <li><a href="#giving-a-signal">Giving A Signal</a></li>
      <li><a href="#a-visual-representation">A Visual Representation</a></li>
    </ul>
  </li>
  <li><a href="#out-of-the-frying-pan-and-into-the-fire-creating-our-own-task">Out Of The Frying Pan And Into The Fire: Creating Our Own Task</a>
    <ul>
      <li><a href="#requirements">Requirements</a></li>
      <li><a href="#getting-the-logs">Getting The Logs</a></li>
      <li><a href="#filtering-and-saving-failures">Filtering And Saving Failures</a></li>
      <li><a href="#factory-fresh">Factory Fresh</a></li>
    </ul>
  </li>
  <li><a href="#the-berry-on-top--our-physical-feedback">The Berry On Top: Our Physical Feedback</a>
    <ul>
      <li><a href="#dollar-store-google-assistant">Dollar Store Google Assistant</a></li>
    </ul>
  </li>
  <li><a href="#the-good-the-bad---the-ugly--summary">The Good, The Bad &amp; … The Ugly?</a></li>
</ul>

<h1 id="introduction">Introduction</h1>

<p>7 weeks ago I started my internship at Ordina Mechelen.
I had several project options available all looking to touch new and unknown tech that might be relevant for future operations.</p>

<p>My inner Judas spoke to me when I saw a listing about a project that would shoot toy rockets at developers if they broke a build, and it would provide a great opportunity to pull myself out of my comfort zone focusing more on Devops and Cloud platforms rather than pure programming.
Sadly due to a global hardware shortage the toy rocket launcher was not available for delivery anymore, so I decided to use a raspberry pi to fetch the build logs and convert them into audio using google text to speech.</p>

<h1 id="the-task-at-hand">The Task At Hand</h1>

<p>The project described a ci-cd pipeline that would trigger a raspberry pi once a build fails, then in response the pi would operate a toy rocket launcher unit that would target the developer responsible for breaking the build.
As such the final project can be broken down into these steps:</p>

<ul>
  <li>Create a sacrificial bare-bones spring boot project to put through the ringer</li>
  <li>Create a pipeline which performs some cookie cutter tasks</li>
  <li>Expand pipeline to setup AWS infrastructure</li>
  <li>Expand pipeline to provision said infrastructure</li>
  <li>Create a custom pipeline task to fetch and push build logs</li>
  <li>Configure raspberry pi to host a node.js server</li>
  <li>Listen for new log files</li>
  <li>If new log files have been found, search for error messages and convert those via text to speech(TTS)</li>
  <li>Broadcast the failures of your colleagues</li>
</ul>

<h1 id="exploring-the-environment">Exploring The Environment</h1>
<p>I’m going to dive right into the meat and potatoes of this project and write about the pipeline since the spring boot application does nothing more than display some basic html and runs a couple of unit tests.
The devops environment that was used consisted of a couple of things.</p>
<h3 id="azure-repos">Azure Repos</h3>
<p>A simple git instance on the Azure platform used for version control of our spring boot project.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/repo_position.png" style="margin:0px auto; max-width: 100%;" /></p>

<h3 id="pipeline">Pipeline</h3>
<p>The bread and butter of our operation. Using a data serialization language called yaml we are able to define each individual task we want applied to our code.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/pipeline_position.png" style="margin:0px auto; max-width: 100%;" /></p>

<h3 id="library">Library</h3>
<p>A place to store key value pairs that we can group and later reference in our yaml file.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/library_position.png" style="margin:0px auto; max-width: 100%;" /></p>

<h3 id="service-connections">Service Connections</h3>
<p>Predefined connections to internal (Azure) or external services from which we can later extract credentials to gain access in the pipeline.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/service_connection_position.png" style="margin:0px auto; max-width: 100%;" /></p>

<h1 id="into-the-rabbit-hole-setting-up-the-pipeline">Into The Rabbit-Hole: Setting Up The Pipeline</h1>
<p>In this section I will initially explain how to set up some basic tasks within our yaml file for building and testing. 
Next, I’ll move on to containerizing our build. 
Finally, I’ll explain how I have used IaC (Infrastructure as Code) to firstly spin up an RDS (AWS) instance based on Postgres and secondly use Helm to deploy the application to an EKS (AWS) cluster owned by JWorks.</p>
<h3 id="before-we-dive-in">Before We Dive In</h3>
<p>Before we dive in, there are some nice to know things about the inner workings and structure of a pipeline defined in a yaml file.
I’ll briefly go over some key definitions, so you can follow along when each individual task gets explained.</p>
<ul>
  <li>Triggers :
    <ul>
      <li>Triggers are (like the word implies) what starts a pipeline</li>
      <li>These can be changes in a branch like <strong><em>main</em></strong> or <strong><em>develop</em></strong> but could also be specific events happening in another pipeline such as failed jobs/stages or a specific variable value</li>
    </ul>
  </li>
  <li>Variables :
    <ul>
      <li>A hardcoded variable defined at the start of your pipeline</li>
      <li>A variable group containing secret values like tokens that can not be acquired using service connections</li>
      <li>Both of these options can be defined at the same time or individually and used anywhere in the pipeline including in additional task commands if the task allows it.</li>
    </ul>
  </li>
  <li>Stages :
    <ul>
      <li>Defines what steps your pipeline should take in what order.</li>
      <li>Encapsulation of <strong><em>stage</em></strong> sections</li>
    </ul>
  </li>
  <li>Stage :
    <ul>
      <li>A section of your pipeline</li>
      <li>Can be given a name of your choosing eg: Test,Docker,CloudSetup …</li>
      <li>Encapsulation for <strong><em>jobs</em></strong></li>
    </ul>
  </li>
  <li>Jobs :
    <ul>
      <li>Encapsulation of <strong><em>job</em></strong> sections</li>
    </ul>
  </li>
  <li>Job :
    <ul>
      <li>Can be given a name of your choosing just like the <strong><em>stage</em></strong> section</li>
      <li>Can be given a <strong><em>pool</em></strong> attribute to define which agent OS has to run this job</li>
      <li>Encapsulation of one or more <strong><em>task</em></strong> sections</li>
    </ul>
  </li>
  <li>Task :
    <ul>
      <li>A pre-built or custom-made task to be performed on your pipeline run.</li>
      <li>Has a variety of attributes that can be manually filled up such as credentials or dictating your preferred working directories</li>
    </ul>
  </li>
  <li>Agents :
    <ul>
      <li>A machine hosted by the cloud provider (Azure in our case) that runs on a specific OS</li>
      <li>Defined in the <strong><em>pool</em></strong> attribute of a <strong><em>job</em></strong> or at the start of a pipeline.</li>
      <li>Mostly a clean slate with only some essential software pre-installed eg: Docker</li>
      <li>Gets wiped after use in order to accommodate the next job.</li>
    </ul>
  </li>
</ul>

<p>All of the above gets combined into a structure that resembles following code.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">variables</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s">my-variable-group</span>

<span class="na">trigger</span><span class="pi">:</span> <span class="s">main</span>

<span class="na">pool</span><span class="pi">:</span>
  <span class="na">vmImage</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

<span class="na">stages</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">stage</span><span class="pi">:</span>
  <span class="na">jobs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">myJob</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">echo "Hello"</span> 
</code></pre></div></div>

<h3 id="basic-tasks">Basic Tasks</h3>
<p>Following are the pipeline tasks used to test our java project, generate a test rapport and then build it using Maven.</p>
<h4 id="maven-test">Maven Test</h4>
<p>To test our application we will be using JUnit because of the pre-existing support given by Azure. 
This will also generate a test rapport during each pipeline run based on the unit tests defined in our project.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/maven_test.png" style="margin:0px auto; max-width: 50%;" /></p>

<h4 id="maven-build">Maven Build</h4>
<p>A standard task using the Maven goal of ‘package’ which returns a JAR file that can later be used by Docker.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/maven_build.png" style="margin:0px auto; max-width: 50%;" /></p>

<h4 id="copying-and-creating-an-artifact">Copying And Creating An Artifact</h4>
<p>In order to use our build across multiple agents we need to create an artifact out of the build.
This artifact gets stored within the pipeline and can get called upon whenever we please.
We do this by first copying our build to a directory on our agent that functions as the default staging directory for artifacts.
By using a second task we take that build and publish it to our pipeline storage.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/copy_and_publish.png" style="margin:0px auto; max-width: 50%;" /></p>

<h3 id="containerization">Containerization</h3>
<p>Here we use the artifact we created during our last job to create an image and push it to Dockerhub.</p>
<h4 id="fetching-our-artifact">Fetching Our Artifact</h4>
<p>First we have to fetch the artifact that we uploaded to our pipeline and place it in the appropriate directory on our new agent.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/download_artifact.png" style="margin:0px auto; max-width: 50%;" /></p>

<h4 id="creating-an-image">Creating An Image</h4>
<p>Then we use said artifact together with a Dockerfile that was previously placed within our java project to create and upload an image to Dockerhub.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/docker_task.png" style="margin:0px auto; max-width: 50%;" /></p>

<h3 id="setting-up-a-cloud-database">Setting Up A Cloud Database</h3>
<p>In this job we will use Terraform to set up an RDS (AWS) database based on Postgres for our containerized java application.
Our Terraform files are stored in the java project under a folder called infrastructure and can be called upon directly, alternatively a remote folder containing Terraform files can be specified if you want or need to split up your project files.
Credentials needed to get access to AWS services come from a manually pre-defined service connection.</p>
<h4 id="installing-terraform">Installing Terraform</h4>
<p>In order to use Terraform on our agent we have to first install it to our agent since it is not supplied by default.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/terraform_install_task.png" style="margin:0px auto; max-width: 50%;" /></p>

<h4 id="initializing-terraform">Initializing Terraform</h4>
<p>This task performs several initialization steps in order to prepare the current working directory for use with Terraform.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/terraform_init.png" style="margin:0px auto; max-width: 75%;" /></p>

<h4 id="terraform-plan">Terraform Plan</h4>
<p>Plans out what configurations and steps will be made once the apply command is given.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/terraform_plan_task.png" style="margin:0px auto; max-width: 75%;" /></p>

<h4 id="terraform-apply">Terraform Apply</h4>
<p>Excecuting our Terraform plan defined in the previous step.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/terraform_apply.png" style="margin:0px auto; max-width: 75%;" /></p>

<h3 id="provisioning-a-cloud-cluster">Provisioning A Cloud Cluster</h3>
<p>Now that we have an image of our app and place to store data to only one crucial step remains, launching our application.
Our application gets deployed to EKS (Elastic Kubernetes Service) which is another AWS service designed for running cloud based Kubernetes.
In order to do so a Helm chart has been made which like the Terraform files is stored under the infrastructure directory of our project.
These charts are defined in a yaml format where specifications for Kubernetes are being made eg: Name of the app, Kind , Amount of replicas, Image to use …</p>

<h4 id="helm-deploy">Helm Deploy</h4>
<p>Using our Helm chart and a service connection allowing us to deploy to the Jworks cluster, we deploy our application, which gets pulled from Dockerhub, to the “stage-thomas-more” namespace within EKS.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/helm_task.png" style="margin:0px auto; max-width: 75%;" /></p>

<h3 id="giving-a-signal">Giving A Signal</h3>
<p>Now that everything has been set up and all the services are up and running it’s time to give our developers a heads-up.
I did this using a Telegram bot that will broadcast a message for every build that has run.
The bot token was stored in the <strong>library</strong> as a secret key-value pair.</p>
<h4 id="creating-our-bot">Creating Our Bot</h4>
<p>This is a prerequisite if you want to work with Telegram since a bot token and a chat id are required to function.
Telegram has a neat tutorial on how to create your own bot using the “Botfather” which you can find here : <a href="https://core.telegram.org/bots" target="_blank" rel="noopener noreferrer">The Botfather</a></p>
<h4 id="sending-out-notifications">Sending Out Notifications</h4>
<p>Now that we have our bot token and a chat id we can define a message that gets sent everytime the task is reached.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/telegram_task.png" style="margin:0px auto; max-width: 50%;" /></p>

<h3 id="a-visual-representation">A Visual Representation</h3>
<p>Displayed below you will find two images representing the pipeline and the goals they accomplish on the Cloud.</p>

<p>For now pay no attention to the little logo displaying Eric Cartman, this is the image I used to represent my custom task which we will get to in the following section.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/pipeline_flow.png" style="margin:0px auto; max-width: 75%;" /></p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/AWS_diagram_final_image.png" style="margin:0px auto; max-width: 75%;" /></p>

<h1 id="out-of-the-frying-pan-and-into-the-fire-creating-our-own-task">Out Of The Frying Pan And Into The Fire: Creating Our Own Task</h1>
<p>During week 5 all of the above was learned, implemented and configured to a working state so a question was asked by Frederick Bousson the solutions lead at the Jworks Ordina Unit if it was possible to create a custom task for use in the pipeline.</p>

<p>Up for another challenge I stepped into the pretty unexplored (And not fully documented) lands of developing a task for a pipeline.
The main objective of the task is to get the pipeline logs from a predefined pipeline run or from the current one as default.
Those logs get filtered and send to a DynamoDB instance hosted on AWS.</p>

<h4 id="requirements">Requirements</h4>
<ul>
  <li>Node.js</li>
  <li>TFX : A packaging tool</li>
  <li>Microsoft VSS Web Extension SDK package</li>
  <li>Some experience writing in Javascript or Typescript</li>
  <li>A Visual Studio publisher account (free)</li>
</ul>

<h4 id="getting-the-logs">Getting The Logs</h4>
<p>This was done using the Azure Devops REST API: <a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/?view=azure-devops-rest-7.1" target="_blank" rel="noopener noreferrer">Documentation</a></p>

<p>To get builds, a couple of things are required:</p>
<ul>
  <li>The Azure Devops organization name</li>
  <li>The project name</li>
  <li>The build number</li>
  <li>Authorization</li>
</ul>

<p>While the values for point one and two were pretty straightforward gaining access to the <strong>build logs</strong> required a <strong>build id</strong> instead of a <strong>build number</strong> , and since the <strong>build id</strong> can not be traced through the UI of Azure Devops some nested API requests were required.</p>

<p>The Authorization was gained through the creation of a PAT token that can be used as a header in the GET Request.</p>
<h4 id="filtering-and-saving-failures">Filtering And Saving Failures</h4>
<p>Now that we have our desired logs all that remains is filtering, formatting and sending those logs to DynamoDB.
In order to complete this operation the following steps were taken:</p>
<ul>
  <li>Set up authorization in a way that allows developers to use their AWS service connection.</li>
  <li>Use the AWS SDK combined with the credentials from the service connection to authorize the user.</li>
  <li>Filter the received logs which had a format of plain text using regex to find possible error messages</li>
  <li>Format the error messages together with the developer responsible for the build and the time of build.</li>
  <li>Push our formatted object to DynamoDB</li>
</ul>

<h4 id="factory-fresh">Factory Fresh</h4>
<p>Eh Voilà!
Our extension does everything we hoped it would do, so it’s time implement it in our pipeline.</p>

<p>First we compile our Typescript to Javascript since the index.js file is the default node entry point.
We then package our extension, and finally upload it using the management portal where we share it with our organizations of choice.</p>

<p>The result:</p>

<p>In my publisher account:
<img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/custom_task_in_marketplace.png" style="margin:0px auto; max-width: 75%;" /></p>

<p>In the pipeline:
<img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/custom_extension_task.png" style="margin:0px auto; max-width: 50%;" /></p>

<p>Want to check out the code? Take a look at the project repo : <a href="https://github.com/MarienL1995/customTaskPublic" target="_blank" rel="noopener noreferrer">Github</a></p>

<h1 id="the-berry-on-top--our-physical-feedback">The Berry On Top : Our Physical Feedback</h1>
<p>Almost there!
Finally, it is time for the actual dirty work namely snitching on our dear colleagues.
To do this I only needed two things, a raspberry pi and a bluetooth speaker.</p>

<h3 id="dollar-store-google-assistant">Dollar Store Google Assistant</h3>
<p>Initially we had planned to use a toy rocket launcher as our physical feedback machine.
That idea was scrapped however because of a global shortage (or tremendous price increase) for all hardware components.</p>

<p>Next the Google Assistant came to mind which is embedded in Android devices or a Google home speaker.
The problem with this idea unfortunately was that the Google Assistant was never designed to take in text input through an API because devices running Google Assistant had no direct endpoints.
Now we could in fact work around this and set up a Home automation system like Home Assistant or Node Red but this would mean that our speaker could never change location without reconfiguring access to its new network.</p>

<p>A final solution I came up with in secret while my mentor was away on a conference in Valencia, was to run a Node.js server on a Raspberry Pi that after booting takes a reference log from our DynamoDB database.
Every minute it would get the latest log available and compare it to the log it had stored, this way when a difference in logs had been found it knew it was time to call out the developer.</p>

<p>Through a nifty npm package we are able to send our text message that we want converted to an audio file and get an url in return pointing to an audio file.
Using Node file system I programmatically created a text file where each audio url alternated with a path to a local audio file gets written on a line in the previously created text file.
What I had just created was a playlist which dictated the order of audio files to be played.
All I had to do now was hook it up to a media player.</p>

<p><strong><em>note</em></strong>: This not the ideal solution, but it allowed the Pi and speaker to be portable to any location as long as we could connect it to wi-fi.</p>

<p>A succesfull pipeline run broadcast(Sound up):</p>

<div class="responsive-video">
  
    <iframe src="https://www.youtube.com/embed/W4LZsEbTRF4" frameborder="0" allowfullscreen="true"> </iframe>
  
</div>

<p>A failed pipeline run broadcast(Sound up):</p>

<div class="responsive-video">
  
    <iframe src="https://www.youtube.com/embed/6PS0K2zdW-o" frameborder="0" allowfullscreen="true"> </iframe>
  
</div>

<h1 id="the-good-the-bad---the-ugly--summary">The Good, The Bad &amp; … The Ugly? : Summary</h1>

<p>Like I mentioned at the start of this blog, there were a number of different project options to choose from as an internship topic.
The reason I went with the ci-cd route is that I knew it would pull me out of my comfort zone and broaden my view on development in general.</p>

<p>While having touched on basic CLI environments like Docker or Bash it always felt cryptic to use a multitude of flags and if you messed up the error messages weren’t all that clear compared to an error with a web framework like React for example.</p>

<p>After 7 weeks of submerging myself mostly in configuration files like .yaml and .tf(Terraform) combined with CLI tools such as kubectl for Kubernetes, psql for Postgres and AWS CLI for AWS Configuration, I’m glad to say that i feel a lot more at home touching on tools not necessarily meant for pure programming.</p>

<p>For a total recap of tools and software used during the project, I put together the following image.</p>

<p><img class="image fit" src="/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/tech_summary.png" style="margin:0px auto; max-width: 75%;" /></p>

<p>As a final sendoff I want to say a quick thank you to my mentor Nick Geudens for guiding me through the jungle of DevOps and AWS and to Frederick Bousson for coming up with the project and allowing me the opportunity to execute it.</p>


        </div>
    </div>
    <div class="share-page" >
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://ordina-jworks.github.io/internship/2022/07/07/snitching-on-your-colleagues-using-cloud-magic.html&title=Snitching On Your Colleagues Using Cloud Magic&source=https://ordina-jworks.github.io" rel="nofollow" target="_blank" title="Share on LinkedIN">
            <img src="/img/social-media/LinkedIn.png"
                 alt="Share on LinkedIn" />
        </a>
        <a href="https://twitter.com/intent/tweet?text=Snitching On Your Colleagues Using Cloud Magic&url=https://ordina-jworks.github.io/internship/2022/07/07/snitching-on-your-colleagues-using-cloud-magic.html&via=lifeatordinabe&related=lifeatordinabe" rel="nofollow" target="_blank" title="Share on Twitter">
            <img src="/img/social-media/Twitter.png"
                 alt="Share on Twitter" />
        </a>
        <a href="https://facebook.com/sharer.php?u=https://ordina-jworks.github.io/internship/2022/07/07/snitching-on-your-colleagues-using-cloud-magic.html" rel="nofollow" target="_blank" title="Share on Facebook">
            <img src="/img/social-media/Facebook.png"
                 alt="Share on Facebook" />
        </a>
    </div>
        
</section>


<section id="two" class="wrapper alt spotlight style2">
    
    <div class="inner">
        <a href="/author/lander_marien/" class="image spotlight-image" title="">
            <img src="/img/author/lander_marien.jpg"
                 alt="" class="p-image"/>
        </a>

        <div class="content">
            
            <p><p>Lander is a graduating student Programming at Thomas More Campus De Nayer.</p>
</p>
            
        </div>
    </div>
    
</section>

        </div>
    </section>
</div>



<footer>
    <div class="contact">
        <div class="address">
            <div class="icon"><i class="fa fa-fw fa-home"></i></div>
            <div class="text">Ordina Belgium<br/>Blarenberglaan 3B,<br/>2800 Mechelen, Belgium</div>
        </div>
        <div class="phone">
            <div class="icon"><i class="fa fa-fw fa-phone"></i></div>
            <div class="text"><a href="tel:003215295858">+32 15 29 58 58</a></div>
        </div>
        <div class="email">
            <div class="icon"><i class="fa fa-fw fa-envelope-o"></i></div>
            <div class="text"><a href="mailto:jworks@ordina.be">jworks@ordina.be</a></div>
        </div>
    </div>
    <ul class="social">
        <li>
            <a href="https://twitter.com/lifeatordinabe" target="_blank">
                <i class="fa fa-fw fa-twitter"></i><span>Twitter</span>
            </a>
        </li>
        <li>
            <a href="https://www.facebook.com/lifeatordinabe" target="_blank">
                <i class=" fa fa-fw fa-facebook"></i><span>Facebook</span>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/company/ordinabelgium" target="_blank">
                <i class=" fa fa-fw fa-linkedin"></i><span>LinkedIn</span>
            </a>
        </li>
        <li>
            <a href="/youtube" target="_blank">
                <i class=" fa fa-fw fa-youtube"></i><span>YouTube</span>
            </a>
        </li>
        <li>
            <a href="/github" target="_blank">
                <i class=" fa fa-fw fa-github"></i><span>GitHub</span>
            </a>
        </li>
        <li>
            <a href="/feed.xml" target="_blank">
                <i class=" fa fa-fw fa-rss"></i><span>RSS Feed</span>
            </a>
        </li>
    </ul>
    <div class="copyright">
        &copy; 2022 Ordina JWorks. All rights reserved.
        <br /> Disclaimer: Opinions expressed on this blog reflect the writer's views and not the position of Ordina
        <img id="analyticsImg" src="" width="1" height="1" style="border: 0px"/>
    </div>
</footer>
<!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollex.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/jquery.pin.min.js"></script>
<script src="/js/util.js"></script>
<!--[if lte IE 8]>
<script src="/js/ie/respond.min.js"></script><![endif]-->


<script>
    var imageHref = "/img/2022-07-07-snitching-on-your-colleagues-using-cloud-magic/Betrayal.jpg";
    $(function () {
        $('body').addClass('toggle');
    });
</script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o);
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-70040502-1', 'auto');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
    window.addEventListener('load', function () {
        if (window.ga && ga.create) {
            console.log('GA loaded correctly');
        } else {
            console.log('GA is blocked or failed to load - tracking manually...')
            document.getElementById('analyticsImg').src = 'https://jworks-techblog-analytics.cfapps.io/collect?title=' + document.title;
        }
    }, false);
</script>

<!-- Vertical timeline -->
<script src="/js/vertical-timeline/modernizr.js"></script>
<script src="/js/vertical-timeline/main.js"></script>


</body>
</html>
