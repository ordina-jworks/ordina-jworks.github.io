<!DOCTYPE html>
<!--suppress ALL -->
<html>
<head>
        <meta charset="utf-8">
    <meta name="description" content="We build innovative solutions with Java and JavaScript. To support this mission, we have several Competence Centers. From within those Competence Centers, we provide coaching to the employee and expert advice towards our customer. In order to keep in sync with the latest technologies and the latest trends, we frequently visit conferences around the globe.
">
    <meta name="keywords" content="Ordina,ORAJ,JWorks,Blog,Java,JavaScript,TypeScript,Angular,DevOps">
    <meta name="author" content="Ordina Belgium">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/img/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/img/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/favicons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/img/favicons/favicon-128.png" sizes="128x128" />

    

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Testing Angular with Karma 101 - Martijn Willekens">
    <meta name="twitter:description" content="Ordina JWorks Tech Blog">
    <meta name="twitter:image" content="http://ordina-jworks.github.io/img/2017-10-02-testing-angular-with-karma/unit-tests.png"/>

    <!-- Facebook Open Graph -->
    <meta property="og:url" content="http://ordina-jworks.github.io/angular/2017/10/04/Testing-angular-with-karma.html"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Testing Angular with Karma 101 - Martijn Willekens"/>
    <meta property="og:description" content="Ordina JWorks Tech Blog"/>
    <meta property="og:image" content="http://ordina-jworks.github.io/img/2017-10-02-testing-angular-with-karma/unit-tests.png"/>

    
    <title>Testing Angular with Karma 101 - Martijn Willekens &mdash; Ordina JWorks Tech Blog</title>
    

        <!-- Styles -->
    <!-- Font awesome CSS -->
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <!-- Magnific Popup -->
    <link href="/css/magnific-popup.css" rel="stylesheet">
    <!-- Owl carousel -->
    <link href="/css/owl.carousel.css" rel="stylesheet">

    <!-- CSS for this page -->

    <!-- Syntax highlighting -->
    <link href="/css/syntax.css" rel="stylesheet">


    <!--[if lte IE 8]>
    <script src="/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/css/main.css"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/css/ie9.css"/><![endif]-->
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/ie8.css"/><![endif]-->

    <!-- Custom CSS. Type your CSS code in custom.css file -->
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Vertical timeline -->
	<link rel="stylesheet" href="/css/vertical-timeline/style.css"> <!-- Resource style -->

    <!-- Favicon -->
    <link rel="shortcut icon" href="#">

    <script src="https://use.typekit.net/gzh0mbm.js"></script>
    <script>
        try {
            Typekit.load({async: true});
        } catch (e) {
        }
    </script>
</head>

<body>
<div id="header-image"></div>


<!-- Page Wrapper -->
<div id="page-wrapper">

        <!-- Header -->
    <header id="header">
        <h1>
            <a href="/">
                JWorks Tech Blog
            </a>
        </h1>

        <nav>
            <a href="#menu">Menu</a>
            <form action="/search/" method="get" class="header-search search-form">
                <input type="text" id="search-box-header" name="query" placeholder="Search &hellip;">
            </form>
        </nav>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <div class="inner">
            <h2>Menu</h2>
            <ul class="links">
                <li class="menu-item"><a href="/">Home</a></li>
                <li class="menu-item"><a href="/about">About Us</a></li>
                <li class="menu-item"><a href="/meet-the-team">Meet the team</a></li>
                <li class="menu-item"><a href="/jobs">Jobs</a></li>
                <li class="menu-item"><a href="/search">Search</a></li>
                <li class="menu-item"><a href="https://join.ordina-jworks.io/">JOIN</a></li>
                <li class="menu-item"><a href="/contact">Contact Us</a></li>
            </ul>
            <a href="#" class="close">Close</a>
        </div>
    </nav>

    <section id="banner">
        <header>
            <div class="inner">
                

                <h2>Testing Angular with Karma 101</h2>
                

                
                    Posted Oct 4, 2017


    in <a href="/categories/angular/">Angular</a>



    by
    
        <a href="/author/martijn-willekens/">Martijn Willekens</a>
        
    



    <br/>
    <i class="fa fa-tags"></i>
    
        <a href="/tags/angular/">Angular</a>, 
    
        <a href="/tags/karma/">Karma</a>, 
    
        <a href="/tags/unit-testing/">Unit testing</a>, 
    
        <a href="/tags/jasmine/">Jasmine</a>, 
    
        <a href="/tags/typescript/">TypeScript</a>
    

                

                

            </div>
        </header>
    </section>


    <section id="wrapper">
        <div class="inner">
            <section id="one" class="wrapper spotlight style1 post-body">
    <div class="inner" style="text-align: left;">
        <div class="content">
            <p>Testing your code is as important as writing the code itself. 
This also counts for frontend applications such as Angular apps. 
Unit testing is one way to do so. 
The goal of these kind of tests is to isolate classes and verify the output of its functions to be what you expect when they are called.
We also need a tool to run our tests written in TypeScript.
<a href="https://karma-runner.github.io/" target="_blank">Karma</a> is the one we’ll be using to run tests described in this blog.
It will open a browser, execute pieces of JavaScript and report the results back to you.</p>

<p>Now, I must admit that I’m not too fond of writing tests myself. 
However, I do strongly believe they help a lot towards improving the quality of the code. 
Writing unit tests can be quite a hassle, but with an application that is continuously growing and changing, they are an efficient way to prevent bugs getting to production.</p>

<h1 id="table-of-contents">Table of contents</h1>
<ol>
  <li><a href="#setup">Setup</a></li>
  <li><a href="#writing-tests">Writing tests</a></li>
  <li><a href="#what-to-test">What to test</a></li>
  <li><a href="#tips--tricks">Tips and tricks</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ol>

<h1 id="setup">Setup</h1>
<p>Let’s take a look at how it’s done in an Angular app using Karma.
If you’re using the Angular CLI, you’re in luck because setting up the unit tests is easy. 
It’s already done! 
All you need to do is run <code class="language-plaintext highlighter-rouge">ng test</code> (or <code class="language-plaintext highlighter-rouge">npm test</code>). 
It will transpile your tests and run them using Karma. 
If you’re not using the Angular CLI yet, I recommend creating a new project with the CLI and copying your existing project to it.
It will make your life a lot easier.</p>

<p>Running <code class="language-plaintext highlighter-rouge">ng test</code> will run the tests in watch mode, meaning that every time you save a change to a file, it will automatically rerun your tests. 
Additional flags can be passed like <code class="language-plaintext highlighter-rouge">--single-run</code> to make it run only once. 
When passing the <code class="language-plaintext highlighter-rouge">--code-coverage</code> flag, it generates a report in HTML. 
By default it’s found under <code class="language-plaintext highlighter-rouge">coverage/index.html</code> and it indicates which parts of your code were covered by your unit tests.</p>

<div class="row">
    <img class="image fit" style="max-width: 785px" alt="Code coverage" src="/img/2017-10-02-testing-angular-with-karma/code-coverage.png" />
</div>

<h1 id="writing-tests">Writing tests</h1>
<h2 id="structure">Structure</h2>
<p>Now that the setup is done, let’s look at how to write the tests themselves.
First of all, test files should be named after the <code class="language-plaintext highlighter-rouge">.ts</code> file you’re testing, but with <code class="language-plaintext highlighter-rouge">.spec</code> added to the file name (e.g. when testing <code class="language-plaintext highlighter-rouge">login.component.ts</code>, the test file should be named <code class="language-plaintext highlighter-rouge">login.component.spec.ts</code>). 
It’s best practice to keep the spec file in the same folder as the ts file. So mostly, for a component, you’ll end up with a HTML, scss, spec.ts and ts file in one folder (unless you like to inline your HTML and CSS).</p>

<p>
    <img class="image" alt="Folder structure" src="/img/2017-10-02-testing-angular-with-karma/files.png" />
</p>

<p>Next up, the content of a test file. 
The Jasmine spec is used to format the tests (<a href="https://jasmine.github.io/pages/getting_started.html" target="_blank">more info</a>).
This means that individual tests are grouped together in a <code class="language-plaintext highlighter-rouge">describe</code> block. 
A test itself starts with <code class="language-plaintext highlighter-rouge">it</code>. 
Besides tests, you can also add other blocks to a <code class="language-plaintext highlighter-rouge">describe</code>, like <code class="language-plaintext highlighter-rouge">beforeEach</code>, <code class="language-plaintext highlighter-rouge">beforeAll</code>, <code class="language-plaintext highlighter-rouge">afterEach</code>, <code class="language-plaintext highlighter-rouge">afterAll</code>… 
What these blocks do, is quite self-explanatory. 
Here’s an example how it could be used: when testing a class, you’ll want to create an instance of that class for each test, so instead of writing the same code in each test to create an instance, you could put that code in the <code class="language-plaintext highlighter-rouge">beforeEach</code> clause. 
Simply pass a function (in lambda notation) to <code class="language-plaintext highlighter-rouge">beforeEach</code> containing the code you want it to run.</p>

<p>Within a test itself, the class’ public functions can be called and assertions can be made. 
Assertions are made using the <code class="language-plaintext highlighter-rouge">expect</code> function. You can give it a variable or a call to a function and tell it what you expect the result to be with <code class="language-plaintext highlighter-rouge">toBe</code>, <code class="language-plaintext highlighter-rouge">toEqual</code>, <code class="language-plaintext highlighter-rouge">toBeTruthy</code>, <code class="language-plaintext highlighter-rouge">toBeFalsy</code>, <code class="language-plaintext highlighter-rouge">toBeNull</code>…</p>

<p>Here’s an example:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">NAME_OF_YOUR_CLASS</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">component</span><span class="p">;</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">//initialize</span>
        <span class="nx">component</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppComponent</span><span class="p">();</span>
    <span class="p">});</span>
    
    <span class="c1">//Actual tests</span>
    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should have a car selected</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">//assertions</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">carSelected</span><span class="p">).</span><span class="nx">toBeThruthy</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should find my favorite car brand</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">//assertions</span>
        <span class="kd">const</span> <span class="nx">carBrand</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">getFavoriteCarBrand</span><span class="p">();</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">carBrand</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span> 
<span class="p">});</span> </code></pre></figure>

<p>As you can see, you can pass some text as an argument in the <code class="language-plaintext highlighter-rouge">describe</code> call. 
This is usually the name of the class you’re testing and it’ll be shown when running the tests. 
For the tests themselves, you can also pass some text which will be shown. 
These are mainly used for you to be able to identify failing tests. 
The text should describe what’s being tested, for example “It should get the brand of the car”, could be written as <code class="language-plaintext highlighter-rouge">it('should get the brand of the car', () =&gt; ...</code>.</p>

<h2 id="writing-the-actual-tests">Writing the actual tests</h2>
<p>There are multiple ways to write unit tests for an Angular app. 
Either you use the Angular TestBed, the ReflectiveInjector or you simply call the constructor of the class directly. 
ReflectiveInjector and TestBed have a similar approach, so I’ll only be discussing TestBed here.
It’s something pretty cool Angular came up with in order to test your components. 
TestBed can create components and injects all its dependencies.
The instance of the component that is returned can then be used for testing.
Accessing the view is also possible.</p>

<p>Now, although I said there are multiple ways to unit test an Angular app, there’s actually only one correct way: calling the constructor.
Since TestBed loads the view as well as any components, directives… used in the view, you’re actually also testing how the class integrates with them.
In other words, you’re entering the domain of integration testing, which is also important, but out of scope for this blog post.</p>

<p>The unit tests you would write using the constructor approach, could practically look the same when you would use TestBed to instatiate the components. 
However, there are some problems with using the Angular TestBed for unit tests which I’ll be explaining below.</p>

<h2 id="1-testbed">1. TestBed</h2>
<p>Setting up the TestBed configuration for a component kind of looks like a module definition. 
You should list all components, directives and services that are used by the component you’re testing directly or by importing a module that includes them. 
Calling <code class="language-plaintext highlighter-rouge">createComponent</code> will return a ‘fixture’ which can be used to access the view and also get the instance of the class linked to it. 
With the fixture you can find HTML elements and perform actions on them, verify their content and attributes…
The instance of the class can be used to test its public functions (unit test).</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">AppComponent</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="na">component</span><span class="p">:</span> <span class="nx">AppComponent</span><span class="p">;</span>
    <span class="kd">let</span> <span class="na">fixture</span><span class="p">:</span> <span class="nx">ComponentFixture</span><span class="o">&lt;</span><span class="nx">AppComponent</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
            <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
            <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">CarBrandService</span><span class="p">],</span>
            <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommonLogicModule</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">compileComponents</span><span class="p">();</span>
    <span class="p">}));</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">fixture</span> <span class="o">=</span> <span class="nx">TestBed</span><span class="p">.</span><span class="nx">createComponent</span><span class="p">(</span><span class="nx">AppComponent</span><span class="p">);</span>
        <span class="nx">component</span> <span class="o">=</span> <span class="nx">fixture</span><span class="p">.</span><span class="nx">componentInstance</span><span class="p">;</span>
        <span class="nx">fixture</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should test the class</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">//use component to test the class itself</span>
        <span class="kd">const</span> <span class="nx">carBrand</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">getFavoriteCarBrand</span><span class="p">();</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">carBrand</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should test the view</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">//use component to test the class itself</span>
        <span class="kd">const</span> <span class="nx">carBrand</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">getFavoriteCarBrand</span><span class="p">();</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">carBrand</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">);</span>

        <span class="c1">//use fixture to access the HTML (e.g. get h1 element)</span>
        <span class="kd">const</span> <span class="nx">de</span> <span class="o">=</span> <span class="nx">fixture</span><span class="p">.</span><span class="nx">debugElement</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">h1</span><span class="dl">'</span><span class="p">));</span>
        <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">de</span><span class="p">.</span><span class="nx">nativeElement</span><span class="p">;</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">textContent</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<h3 id="mocking">Mocking</h3>
<p>In unit testing, we are only interested in testing the class itself and try to isolate it as much as possible. 
We also want to be able to easily control the output of all dependencies of our class, such as services.</p>

<h4 id="spyon">spyOn</h4>
<p>One way to do so is by creating spies for all calls to functions of those dependencies. 
That’s where the <code class="language-plaintext highlighter-rouge">spyOn</code> function comes into play:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">AppComponent</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="na">component</span><span class="p">:</span> <span class="nx">RequestPopupContainer</span><span class="p">;</span>
    <span class="kd">let</span> <span class="na">fixture</span><span class="p">:</span> <span class="nx">ComponentFixture</span><span class="o">&lt;</span><span class="nx">AppComponent</span><span class="o">&gt;</span><span class="p">;</span>        

    <span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
            <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
            <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">CarBrandService</span><span class="p">],</span>
            <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommonLogicModule</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">compileComponents</span><span class="p">();</span>
    <span class="p">}));</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">fixture</span> <span class="o">=</span> <span class="nx">TestBed</span><span class="p">.</span><span class="nx">createComponent</span><span class="p">(</span><span class="nx">AppComponent</span><span class="p">);</span>
        <span class="nx">component</span> <span class="o">=</span> <span class="nx">fixture</span><span class="p">.</span><span class="nx">componentInstance</span><span class="p">;</span>

        <span class="kd">const</span> <span class="nx">carBrandService</span> <span class="o">=</span> <span class="nx">fixture</span><span class="p">.</span><span class="nx">debugElement</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">CarBrandService</span><span class="p">);</span>
        <span class="nx">spyOn</span><span class="p">(</span><span class="nx">carBrandService</span><span class="p">,</span> <span class="dl">'</span><span class="s1">findAll</span><span class="dl">'</span><span class="p">).</span><span class="nx">and</span><span class="p">.</span><span class="nx">returnValue</span><span class="p">(</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">([</span>
            <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Japan</span><span class="dl">'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">BMW</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Germany</span><span class="dl">'</span> <span class="p">}</span>
        <span class="p">]));</span>    

        <span class="nx">fixture</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="p">...</span>
<span class="p">});</span></code></pre></figure>

<p>In the example above, you can see when the <code class="language-plaintext highlighter-rouge">AppComponent</code> would call <code class="language-plaintext highlighter-rouge">carBrandService.findAll()</code>, instead of making a HTTP call, an Observable is returned with a list of car brands which is defined in the test itself. 
This is pretty cool, but also very error prone. 
If you forget to place a spy on a certain function, it will perform the actual call, possibly a HTTP call.
That’s something we do not want at all.</p>

<h4 id="mock-classes">Mock classes</h4>
<p>To prevent forgetting to spy on a certain function, you could create mock classes and inject them instead of the actual classes:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="kd">class</span> <span class="nx">MockCarBrandService</span> <span class="p">{</span>
    <span class="nx">findAll</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">CarBrand</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">([</span>
            <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Japan</span><span class="dl">'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">BMW</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Germany</span><span class="dl">'</span> <span class="p">}</span>
        <span class="p">]);</span>     
    <span class="p">}</span>   
<span class="p">}</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">AppComponent</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="na">component</span><span class="p">:</span> <span class="nx">AppComponent</span><span class="p">;</span>
    <span class="kd">let</span> <span class="na">fixture</span><span class="p">:</span> <span class="nx">ComponentFixture</span><span class="o">&lt;</span><span class="nx">AppComponent</span><span class="o">&gt;</span><span class="p">;</span>        

    <span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
            <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
            <span class="na">providers</span><span class="p">:</span> <span class="p">[{</span><span class="na">provide</span><span class="p">:</span> <span class="nx">CarBrandService</span><span class="p">,</span> <span class="na">useClass</span><span class="p">:</span> <span class="nx">MockCarBrandService</span><span class="p">}],</span>
            <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommonLogicModule</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">compileComponents</span><span class="p">();</span>
    <span class="p">}));</span>

    <span class="p">...</span>
<span class="p">});</span></code></pre></figure>

<p>Again we see that <code class="language-plaintext highlighter-rouge">findAll()</code> will return an Observable containing a list. 
By using this approach, you’ll get an error when you forgot to define a function in the mock class. 
This may solve our previous problem, but now we have created another one. 
Karma allows us to assert whether a function was called using <code class="language-plaintext highlighter-rouge">toHaveBeenCalled</code> and <code class="language-plaintext highlighter-rouge">toHaveBeenCalledWith</code>. 
The problem here is that we don’t have any spies, so those functions can’t be used.
We can again add spies like in the first approach, but you can imagine that this is a lot of work and will get quite messy.</p>

<h4 id="jasmine-spy-objects">Jasmine spy objects</h4>
<p>So, the first two approaches have some issues. Luckily there’s a better way, Jasmine spy objects:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">AppComponent</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>        
    <span class="kd">let</span> <span class="na">component</span><span class="p">:</span> <span class="nx">AppComponent</span><span class="p">;</span>
    <span class="kd">let</span> <span class="na">fixture</span><span class="p">:</span> <span class="nx">ComponentFixture</span><span class="o">&lt;</span><span class="nx">AppComponent</span><span class="o">&gt;</span><span class="p">;</span> 

    <span class="kd">const</span> <span class="nx">mockCarBrandService</span> <span class="o">=</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">createSpyObj</span><span class="p">(</span><span class="dl">'</span><span class="s1">carBrandService</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">findAll</span><span class="dl">'</span><span class="p">]);</span>
    <span class="nx">mockCarBrandService</span><span class="p">.</span><span class="nx">findAll</span><span class="p">.</span><span class="nx">and</span><span class="p">.</span><span class="nx">returnValue</span><span class="p">(</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">([</span>
        <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Japan</span><span class="dl">'</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">BMW</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Germany</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">]);</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
            <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
            <span class="na">providers</span><span class="p">:</span> <span class="p">[{</span><span class="na">provide</span><span class="p">:</span> <span class="nx">CarBrandService</span><span class="p">,</span> <span class="na">useValue</span><span class="p">:</span> <span class="nx">mockCarBrandService</span><span class="p">}],</span>
            <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommonLogicModule</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">compileComponents</span><span class="p">();</span>
    <span class="p">}));</span>
    <span class="p">...</span>
<span class="p">});</span></code></pre></figure>

<p>The first argument of <code class="language-plaintext highlighter-rouge">jasmine.createSpyObj</code> is the name for the object and will be used to mention it in the console.
This is usually the name you gave the instance of the corresponding class in the constructor. 
The second argument is an array containing all function names of that corresponding class that are called from the class being tested. 
In other words, not all functions offered by the class that’s being mocked have be listed, only the ones actually being used.</p>
<blockquote>
  <p>Also note that in the providers list, we have to use <code class="language-plaintext highlighter-rouge">useValue</code> instead of <code class="language-plaintext highlighter-rouge">useClass</code> since <code class="language-plaintext highlighter-rouge">jasmine.createSpyObj</code> already returns an instance.</p>
</blockquote>

<p>Using <code class="language-plaintext highlighter-rouge">spyOn</code> isn’t needed, a spy object is already being spied upon (hence the name) and you can call the <code class="language-plaintext highlighter-rouge">toHaveBeenCalled</code> and <code class="language-plaintext highlighter-rouge">toHaveBeenCalledWith</code> functions on it.</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="p">...</span>
<span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should call the findAll method</span><span class="dl">'</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">component</span><span class="p">.</span><span class="nx">getFavoriteCarBrand</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">mockCarBrandService</span><span class="p">.</span><span class="nx">findAll</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="p">});</span> 
<span class="p">...</span></code></pre></figure>

<p>I think it’s obvious to say that using Jasmine spy objects is the way to go. 
If you forget to define a function, you’ll get an error when it’s called. 
The functions that are defined, are also spied upon. 
So all the problems with the first and second approach are solved. 
There’s even another benefit when using spy objects. 
The implementation (<code class="language-plaintext highlighter-rouge">returnValue</code> or <code class="language-plaintext highlighter-rouge">callFake</code>) can be changed at any time, even in the middle of a test!</p>

<h3 id="issues-with-unit-testing">Issues with unit testing</h3>
<p>A side effect of using TestBed is that when the component is loaded, the <code class="language-plaintext highlighter-rouge">ngOnInit</code>, <code class="language-plaintext highlighter-rouge">ngAfterViewInit</code>… lifecycle events are called automatically.
This means you have less control over them.</p>

<p>Getting all the imports, providers and declarations setup can be quite a struggle too. 
If there’s any subcomponent in the HTML of the component you’re testing, they should either be imported through a module or added in the declarations of the TestBed configuration.
If you don’t feel like doing all that, you can also tell Angular to skip elements it doesn’t recognise by adding <code class="language-plaintext highlighter-rouge">NO_ERRORS_SCHEMA</code> to the TestBed configuration:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
    <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span> <span class="nx">AppComponent</span> <span class="p">],</span>
    <span class="na">schemas</span><span class="p">:</span> <span class="p">[</span> <span class="nx">NO_ERRORS_SCHEMA</span> <span class="p">]</span>
<span class="p">})</span></code></pre></figure>

<p>It’s very likely that you’ll be using the Angular router in some of your components, so you’ll have to account for that too. 
You could mock the router dependency using a Jasmine spy object or you can add <code class="language-plaintext highlighter-rouge">RouterTestingModule</code> as an import instead of the <code class="language-plaintext highlighter-rouge">RouterModule</code> itself. 
The routes that are relevant can then be defined in the <code class="language-plaintext highlighter-rouge">RouterTestingModule</code>:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">RouterTestingModule</span><span class="p">.</span><span class="nx">withRoutes</span><span class="p">([</span><span class="cm">/*List mock routes here*/</span><span class="p">])]</span></code></pre></figure>

<blockquote>
  <p>To learn more about writing tests using Angular TestBed, I recommend reading this guide: <a href="https://angular.io/guide/testing" target="_blank">https://angular.io/guide/testing</a>.</p>
</blockquote>

<h2 id="2-calling-the-constructor">2. Calling the constructor</h2>

<p>A much better way to do unit testing is to simply call the constructor of the class you want to test.
You should get an instance of each dependency that’s needed in the component’s constructor.
Of course we want to mock these classes and as we saw in the Angular TestBed section, the Jasmine spy objects are the way to go.</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">AppComponent</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>        
    <span class="kd">let</span> <span class="na">component</span><span class="p">:</span> <span class="nx">AppComponent</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">mockCarBrandService</span> <span class="o">=</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">createSpyObj</span><span class="p">(</span><span class="dl">'</span><span class="s1">carBrandService</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">findAll</span><span class="dl">'</span><span class="p">]);</span>
    <span class="nx">mockCarBrandService</span><span class="p">.</span><span class="nx">findAll</span><span class="p">.</span><span class="nx">and</span><span class="p">.</span><span class="nx">returnValue</span><span class="p">(</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">([</span>
        <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Japan</span><span class="dl">'</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">BMW</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Germany</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">]);</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">component</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppComponent</span><span class="p">(</span><span class="nx">mockCarBrandService</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="p">...</span>
<span class="p">});</span></code></pre></figure>

<p>Without the TestBed, you don’t have access to the view. 
However, your tests will run much faster as there are less things to load. 
When using TestBed, you’ll probably be including lots of dependencies just to make it work, giving you less control. 
This is something you do not want in unit testing as you want to isolate the class as much as possible. 
Another difference with TestBed is that you have to call the lifecycle events yourself, again giving you more control over the code you’re testing.</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should find the car brand</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">component</span><span class="p">.</span><span class="nx">ngOnInit</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">carBrand</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">getFavoriteCarBrand</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">carBrand</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span> </code></pre></figure>

<h1 id="async-fakeasync-tick">Async, fakeAsync, tick</h1>
<p>Angular is full of Observables and writing tests for them is a little trickier. 
You might also be using the <code class="language-plaintext highlighter-rouge">setTimeout</code> and <code class="language-plaintext highlighter-rouge">setInterval</code> functions. 
To cope with all that, Angular provides the <code class="language-plaintext highlighter-rouge">async</code> and <code class="language-plaintext highlighter-rouge">fakeAsync</code> functions. 
You can simply wrap your test in an <code class="language-plaintext highlighter-rouge">async</code> and it should only finish after all async calls are finished. 
If you want to have more control, you can wrap the test in a <code class="language-plaintext highlighter-rouge">fakeAsync</code> instead. 
Then the <code class="language-plaintext highlighter-rouge">tick()</code> function can be called to advance time with one tick. 
By passing an argument to it, time can be advanced by more ticks at once: <code class="language-plaintext highlighter-rouge">tick(500)</code>.</p>

<p>Suppose we have this class:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="k">export</span> <span class="kd">class</span> <span class="nx">TimeoutExample</span> <span class="p">{</span>
    <span class="nx">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">updateCounterWithDelay</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">counter</span><span class="o">++</span><span class="p">;</span>
        <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And this test:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript">  
<span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should increase the counter with a delay</span><span class="dl">'</span><span class="p">,</span> <span class="nx">fakeAsync</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">component</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TimeoutExample</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="nx">component</span><span class="p">.</span><span class="nx">updateCounterWithDelay</span><span class="p">();</span>
    <span class="nx">tick</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="nx">tick</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="nx">tick</span><span class="p">(</span><span class="mi">90</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}));</span></code></pre></figure>

<p>It clearly shows how the <code class="language-plaintext highlighter-rouge">tick</code> function manipulates the advancement of time, although it isn’t really a useful test,</p>

<h3 id="observables">Observables</h3>

<p>Now, what if you want to test a function that returns an Observable? 
Well, simply subscribe to it in an async block and check the result!</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should return a list of cars</span><span class="dl">'</span> <span class="k">async</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">service</span><span class="p">.</span><span class="nx">findAll</span><span class="p">().</span><span class="nx">take</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
        <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">toBeFalsy</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">}));</span></code></pre></figure>

<p>The error clause may seem strange. 
However, what if the <code class="language-plaintext highlighter-rouge">findAll()</code> call returns an error and you don’t have the error clause in your test? 
You’ll simply think that your test has passed because it appears green in the console. 
With code coverage enabled, you may notice that the part of the code you were testing isn’t marked as covered. 
By adding <code class="language-plaintext highlighter-rouge">expect(true).toBeFalsy();</code> to the error clause, your test will fail because it shouldn’t get there!</p>

<h1 id="what-to-test">What to test</h1>
<p>Now that we know a little on how to test, let’s have a look at what to test.</p>

<p>For starters, you don’t have access to private and protected variables/functions, so all you can do is test the public ones. 
All variables that are accessed by the view should be public, so those are the ones you can use for your tests. 
The constructor and all lifecycle events can be called as well as they are public. 
You should never ever set a variable or function to public in order to test it. 
If you can’t test it because it’s private, you’re doing something wrong. 
You should be able to get to it through other functions.</p>

<p>Generally, you give an input and assert the output, it’s as simple as that. 
Your different inputs should also make sure that all branches are tested (e.g. an <code class="language-plaintext highlighter-rouge">if</code> gives you two branches, one where the <code class="language-plaintext highlighter-rouge">if</code> resolves to <code class="language-plaintext highlighter-rouge">true</code> and one to <code class="language-plaintext highlighter-rouge">false</code>).
Unit tests in Karma also allow you to assert whether a function has been called and optionally with which parameters (<code class="language-plaintext highlighter-rouge">toHaveBeenCalled</code> and <code class="language-plaintext highlighter-rouge">toHaveBeenCalledWith</code>). 
This can be useful when for example testing a <code class="language-plaintext highlighter-rouge">void</code> function that calls a mocked function. 
That way you can still assert the output. 
So, think of possible scenarios for the functions to test, provide the input and assert the output using <code class="language-plaintext highlighter-rouge">expect</code>. 
Also try to cover other paths than just the happy paths!</p>

<p>Testing getters and setters usually isn’t needed, unless they are more complex. 
In most cases they’re not and it’s quite pointless to call a setter and then assert whether it has been set correclty. 
Most of the time, these will be called indirectly when testing other functions.</p>

<p>The code coverage report can help you find functions that aren’t fully tested yet. 
However, your goal shouldn’t be to get a 100% coverage. 
Getting a 100% isn’t that hard, simply calling all functions with some different inputs will get you there.
It won’t mean that your code is fully tested.
To give you an example, suppose you have a function that sorts a list.
You write some tests with different inputs so all branches are covered and you get a 100% coverage.
The ordering of the list could still be completely wrong and not what you expect, although it’s fully covered.
By using <code class="language-plaintext highlighter-rouge">expect</code> to verify that the output is correct, you’ll be doing a way better job.
Even then there may be scenarios that aren’t tested despite the coverage report stating that part of the code is covered.
So try to think of the various possible scenarios (both success and error scenarios) and translate those to tests.</p>

<h1 id="tips--tricks">Tips &amp; tricks</h1>
<h2 id="only-run-certain-tests">Only run certain tests</h2>
<p>When your test base begins to grow, you don’t always want to wait for all tests to have run when only testing a certain class or function. 
Therefore, you can choose to only run specific <code class="language-plaintext highlighter-rouge">describe</code> blocks or tests (<code class="language-plaintext highlighter-rouge">it</code>) by adding an <code class="language-plaintext highlighter-rouge">f</code> (which stands for focus) in front of them, such as <code class="language-plaintext highlighter-rouge">fdescribe</code> and <code class="language-plaintext highlighter-rouge">fit</code>. 
To exclude certain <code class="language-plaintext highlighter-rouge">describe</code> blocks or tests, you can prefix them with an <code class="language-plaintext highlighter-rouge">x</code> (exclude), like <code class="language-plaintext highlighter-rouge">xdescribe</code> and <code class="language-plaintext highlighter-rouge">xit</code>. 
This will certainly come of use.</p>

<h2 id="nesting-describe-blocks">Nesting describe blocks</h2>
<p>Describe blocks can also be nested. 
If you want for example different <code class="language-plaintext highlighter-rouge">beforeEach</code> blocks for your tests when testing a class, you can create a nested <code class="language-plaintext highlighter-rouge">describe</code> block for each case.</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">AppComponent</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">mockCarBrandService</span> <span class="o">=</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">createSpyObj</span><span class="p">(</span><span class="dl">'</span><span class="s1">carBrandService</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">findAll</span><span class="dl">'</span><span class="p">]);</span>

    <span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Happy path</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">mockCarBrandService</span><span class="p">.</span><span class="nx">findAll</span><span class="p">.</span><span class="nx">and</span><span class="p">.</span><span class="nx">returnValue</span><span class="p">(</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">([</span>
                <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Mazda</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Japan</span><span class="dl">'</span> <span class="p">},</span>
                <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">BMW</span><span class="dl">'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Germany</span><span class="dl">'</span> <span class="p">}</span>
            <span class="p">]));</span>
        <span class="p">});</span>

        <span class="nx">it</span><span class="p">(...);</span>
        <span class="p">...</span>
    <span class="p">});</span>
    
    <span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error path</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">mockCarBrandService</span><span class="p">.</span><span class="nx">findAll</span><span class="p">.</span><span class="nx">and</span><span class="p">.</span><span class="nx">returnValue</span><span class="p">(</span><span class="nx">Observable</span><span class="p">.</span><span class="k">throw</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error</span><span class="dl">'</span><span class="p">));</span>

        <span class="nx">it</span><span class="p">(...);</span>
        <span class="p">...</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<h2 id="using-the-injector">Using the injector</h2>
<p>Dependency injection is used all over Angular meaning that it isn’t possible to simply call <code class="language-plaintext highlighter-rouge">new</code> for certain classes. 
Normally, you simply put the dependencies in the constructor of your class and Angular takes care of the rest (e.g. <code class="language-plaintext highlighter-rouge">constructor(private formBuilder: FormBuilder)</code>).
When calling the constructor of a class in a test, you don’t always want to mock those dependencies, so you’ll need to get instances of them somehow. 
For example when using Angular’s <code class="language-plaintext highlighter-rouge">FormBuilder</code> or when you need it to create a <code class="language-plaintext highlighter-rouge">FormGroup</code> to use in your test. 
In that case, you can use Angular’s ReflectiveInjector which takes care of getting an instance for you.
Here’s an example how:</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="kd">const</span> <span class="nx">injector</span> <span class="o">=</span> <span class="nx">ReflectiveInjector</span><span class="p">.</span><span class="nx">resolveAndCreate</span><span class="p">([</span><span class="nx">FormBuilder</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">formBuilder</span> <span class="o">=</span> <span class="nx">injector</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">FormBuilder</span><span class="p">);</span></code></pre></figure>

<p>As you can see, you can simply pass the class name and it will return an instance of that class. 
That instance can then be passed in the constuctor of the class you’re testing.</p>

<h1 id="conclusion">Conclusion</h1>
<p>When writing unit tests, it’s better to call the constructors direcly and not to use Angular TestBed. 
It will give you more freedom and more control, run the tests much faster and allow you to completely isolate classes. 
You should also write integration tests and TestBed will serve that purpose very well.
To mock classes, Jasmine spy objects are simply the way to go.
Changing their implementation or return value is easy and can be done at any time!
Code coverage reports can be very useful to find parts of uncovered code. 
However, getting a high percentage of code coverage shouldn’t be your goal. 
Write useful tests and also, don’t limit your tests to the happy path!</p>

        </div>
    </div>
    <div class="share-page" >
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://ordina-jworks.github.io/angular/2017/10/04/Testing-angular-with-karma.html&title=Testing Angular with Karma 101&source=https://ordina-jworks.github.io" rel="nofollow" target="_blank" title="Share on LinkedIN">
            <img src="/img/social-media/LinkedIn.png"
                 alt="Share on LinkedIn" />
        </a>
        <a href="https://twitter.com/intent/tweet?text=Testing Angular with Karma 101&url=https://ordina-jworks.github.io/angular/2017/10/04/Testing-angular-with-karma.html&via=lifeatordinabe&related=lifeatordinabe" rel="nofollow" target="_blank" title="Share on Twitter">
            <img src="/img/social-media/Twitter.png"
                 alt="Share on Twitter" />
        </a>
        <a href="https://facebook.com/sharer.php?u=https://ordina-jworks.github.io/angular/2017/10/04/Testing-angular-with-karma.html" rel="nofollow" target="_blank" title="Share on Facebook">
            <img src="/img/social-media/Facebook.png"
                 alt="Share on Facebook" />
        </a>
    </div>
        
</section>


<section id="two" class="wrapper alt spotlight style2">
    
    <div class="inner">
        <a href="/author/martijn-willekens/" class="image spotlight-image" title="">
            <img src="/img/author/martijn-willekens.jpg"
                 alt="" class="p-image"/>
        </a>

        <div class="content">
            
            <p><p>Martijn is a frontend developer at Ordina Belgium. He primarily devotes himself to building Angular and Ionic apps written in TypeScript. ReactiveX is his favorite set of tools to work with.</p>
</p>
            
        </div>
    </div>
    
</section>

        </div>
    </section>
</div>



<footer>
    <div class="contact">
        <div class="address">
            <div class="icon"><i class="fa fa-fw fa-home"></i></div>
            <div class="text">Ordina Belgium<br/>Blarenberglaan 3B,<br/>2800 Mechelen, Belgium</div>
        </div>
        <div class="phone">
            <div class="icon"><i class="fa fa-fw fa-phone"></i></div>
            <div class="text"><a href="tel:003215295858">+32 15 29 58 58</a></div>
        </div>
        <div class="email">
            <div class="icon"><i class="fa fa-fw fa-envelope-o"></i></div>
            <div class="text"><a href="mailto:jworks@ordina.be">jworks@ordina.be</a></div>
        </div>
    </div>
    <ul class="social">
        <li>
            <a href="https://www.facebook.com/lifeatordinabe" target="_blank">
                <i class=" fa fa-fw fa-facebook"></i><span>Facebook</span>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/company/ordinabelgium" target="_blank">
                <i class=" fa fa-fw fa-linkedin"></i><span>LinkedIn</span>
            </a>
        </li>
        <li>
            <a href="/youtube" target="_blank">
                <i class=" fa fa-fw fa-youtube"></i><span>YouTube</span>
            </a>
        </li>
        <li>
            <a href="/github" target="_blank">
                <i class=" fa fa-fw fa-github"></i><span>GitHub</span>
            </a>
        </li>
        <li>
            <a href="/feed.xml" target="_blank">
                <i class=" fa fa-fw fa-rss"></i><span>RSS Feed</span>
            </a>
        </li>
    </ul>
    <div class="copyright">
        &copy; 2023 Ordina JWorks. All rights reserved.
        <br /> Disclaimer: Opinions expressed on this blog reflect the writer's views and not the position of Ordina
        <img id="analyticsImg" src="" width="1" height="1" style="border: 0px"/>
    </div>
</footer>
<!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollex.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/jquery.pin.min.js"></script>
<script src="/js/util.js"></script>
<!--[if lte IE 8]>
<script src="/js/ie/respond.min.js"></script><![endif]-->


<script>
    var imageHref = "/img/2017-10-02-testing-angular-with-karma/unit-tests.png";
    $(function () {
        $('body').addClass('toggle');
    });
</script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o);
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-70040502-1', 'auto');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
    window.addEventListener('load', function () {
        if (window.ga && ga.create) {
            console.log('GA loaded correctly');
        } else {
            console.log('GA is blocked or failed to load - tracking manually...')
            document.getElementById('analyticsImg').src = 'https://jworks-techblog-analytics.cfapps.io/collect?title=' + document.title;
        }
    }, false);
</script>

<!-- Vertical timeline -->
<script src="/js/vertical-timeline/modernizr.js"></script>
<script src="/js/vertical-timeline/main.js"></script>


</body>
</html>
